<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>TuCai&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="TuCai's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="TuCai's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TuCai's Blog">
  
    <link rel="alternative" href="/atom.xml" title="TuCai&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.2d7529.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="http://7xvm8m.com1.z0.glb.clouddn.com/tucaiIcon.jpeg" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">TuCai</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/ganyang-eyespage" title="github"><i class="icon-github"></i></a>
		        
					<a class="jianshu" target="_blank" href="http://www.jianshu.com/u/ad64332f3b23" title="jianshu"><i class="icon-jianshu"></i></a>
		        
					<a class="mail" target="_blank" href="mailto:tucai137671@163.com" title="mail"><i class="icon-mail"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="http://7xvm8m.com1.z0.glb.clouddn.com/tucaiIcon.jpeg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">TuCai</h1>
			</hgroup>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/ganyang-eyespage" title="github"><i class="icon-github"></i></a>
			        
						<a class="jianshu" target="_blank" href="http://www.jianshu.com/u/ad64332f3b23" title="jianshu"><i class="icon-jianshu"></i></a>
			        
						<a class="mail" target="_blank" href="mailto:tucai137671@163.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-荼菜的iOS笔记-精解RunLoop笔记" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/荼菜的iOS笔记-精解RunLoop笔记/">荼菜的iOS笔记--精解RunLoop笔记</a>
    </h1>
  

        
        <a href="/2017/03/07/荼菜的iOS笔记-精解RunLoop笔记/" class="archive-article-date">
  	<time datetime="2017-03-07T05:38:39.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-03-07</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-17c60485f9ad98c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="runloop.jpg"></p>
<h1 id="1-Run-Loops-in-Cocoa"><a href="#1-Run-Loops-in-Cocoa" class="headerlink" title="1. Run Loops in Cocoa:"></a>1. Run Loops in Cocoa:</h1><p>  NSURLConnection–(底层)–&gt;AFNetworking<br>  dispatch_get_main_queue()<br>  CADisplaLink  CATransition CAAnimation<br>  NSObject(NSDelayedPerforming) 、NSObject(NSTreadPerformAddition)<br> …</p>
<h1 id="2-RunLoop机制"><a href="#2-RunLoop机制" class="headerlink" title="2. RunLoop机制"></a>2. RunLoop机制</h1><p><img src="http://upload-images.jianshu.io/upload_images/1438251-e9e2b664f4a87f5f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="WechatIMG1.jpeg"></p>
<p>NSRunLoop是CFRunLoop的封装，直接看CF(Core Foundation)这一层就好.</p>
<h1 id="RunLoop与线程和释放池之间的关系："><a href="#RunLoop与线程和释放池之间的关系：" class="headerlink" title="RunLoop与线程和释放池之间的关系："></a>RunLoop与线程和释放池之间的关系：</h1><p>苹果不允许直接创建RunLoop，它只提供了两个自动获取的函数：CFRunLoopGetMain()和CGRunLoopGetCurrent()。这两个函数内部逻辑大概是下面这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">/// 全局的Dictionary，key 是 pthread_t， value 是 CFRunLoopRef</div><div class="line">static CFMutableDictionaryRef loopsDic;</div><div class="line">/// 访问 loopsDic 时的锁</div><div class="line">static CFSpinLock_t loopsLock;</div><div class="line"> </div><div class="line">/// 获取一个 pthread 对应的 RunLoop。</div><div class="line">CFRunLoopRef _CFRunLoopGet(pthread_t thread) &#123;</div><div class="line">    OSSpinLockLock(&amp;loopsLock);</div><div class="line">    </div><div class="line">    if (!loopsDic) &#123;</div><div class="line">        // 第一次进入时，初始化全局Dic，并先为主线程创建一个 RunLoop。</div><div class="line">        loopsDic = CFDictionaryCreateMutable();</div><div class="line">        CFRunLoopRef mainLoop = _CFRunLoopCreate();</div><div class="line">        CFDictionarySetValue(loopsDic, pthread_main_thread_np(), mainLoop);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /// 直接从 Dictionary 里获取。</div><div class="line">    CFRunLoopRef loop = CFDictionaryGetValue(loopsDic, thread));</div><div class="line">    </div><div class="line">    if (!loop) &#123;</div><div class="line">        /// 取不到时，创建一个</div><div class="line">        loop = _CFRunLoopCreate();</div><div class="line">        CFDictionarySetValue(loopsDic, thread, loop);</div><div class="line">        /// 注册一个回调，当线程销毁时，顺便也销毁其对应的 RunLoop。</div><div class="line">        _CFSetTSD(..., thread, loop, __CFFinalizeRunLoop);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    OSSpinLockUnLock(&amp;loopsLock);</div><div class="line">    return loop;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">CFRunLoopRef CFRunLoopGetMain() &#123;</div><div class="line">    return _CFRunLoopGet(pthread_main_thread_np());</div><div class="line">&#125;</div><div class="line"> </div><div class="line">CFRunLoopRef CFRunLoopGetCurrent() &#123;</div><div class="line">    return _CFRunLoopGet(pthread_self());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>CFRunLoop与Thread的关系</strong>：<br>   CFRunLoop与线程是一一绑定的关系（或者理解为RunLoop寄生于线程），一个线程自能有唯一对应的runloop；但是这个根runloop里可以嵌套子runloops。从上面的代码中我们可以看到，线程和RunLoop保存在一个全局的Dictionary里（Dic={@“线程”：@“RunLoop”}）。线程刚创建时并没有RunLoop，如果你不主动获取，那它一直都不会有。RunLoop的创建是发生在第一次获取时，RunLoop的销毁是发生在线程结束时。你只能在一个线程的内部获取其RunLoop（主线程除外）。</li>
<li><strong>CFRunLoop与释放池的关系</strong>：<br>  自动释放池寄生于RunLoop。程序启动后，主线程注册了两个Observer监听runloop的进出与休眠。一个最高级Observer监听Entry状态；一个最低级Observer监听BeforeWaiting状态和Exit状态。</li>
</ul>
<p><em>线程(创建)–&gt;runloop将进入–&gt;最高优先级OB创建释放池–&gt;runloop将睡–&gt;最低优先级OB销毁旧池创建新池–&gt;runloop将退出–&gt;最低优先级OB销毁新池–&gt;线程(销毁)</em></p>
<h1 id="3-CFRunLoopRef的构造："><a href="#3-CFRunLoopRef的构造：" class="headerlink" title="3. CFRunLoopRef的构造："></a>3. CFRunLoopRef的构造：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">struct __CFRunLoopMode &#123;</div><div class="line">    CFStringRef _name;            // Mode Name, 例如 @&quot;kCFRunLoopDefaultMode&quot;</div><div class="line">    CFMutableSetRef _sources0;    // Set</div><div class="line">    CFMutableSetRef _sources1;    // Set</div><div class="line">    CFMutableArrayRef _observers; // Array</div><div class="line">    CFMutableArrayRef _timers;    // Array</div><div class="line">    ...</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">struct __CFRunLoop &#123;</div><div class="line">    CFMutableSetRef _commonModes;     // Set</div><div class="line">    CFMutableSetRef _commonModeItems; // Set&lt;Source/Observer/Timer&gt;</div><div class="line">    CFRunLoopModeRef _currentMode;    // Current Runloop Mode</div><div class="line">    CFMutableSetRef _modes;           // Set</div><div class="line">    ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>这里有个概念叫 “CommonModes”：一个 Mode 可以将自己标记为”Common”属性（通过将其 ModeName 添加到 RunLoop 的 “commonModes” 中）。每当 RunLoop 的内容发生变化时，RunLoop 都会自动将 _commonModeItems 里的 Source/Observer/Timer 同步到具有 “Common” 标记的所有Mode里。</p>
<ul>
<li><strong>应用场景举例</strong>：主线程的 RunLoop 里有两个预置的 Mode：kCFRunLoopDefaultMode 和 UITrackingRunLoopMode。这两个 Mode 都已经被标记为”Common”属性。DefaultMode 是 App 平时所处的状态，TrackingRunLoopMode 是追踪 ScrollView 滑动时的状态。当你创建一个 Timer 并加到 DefaultMode 时，Timer 会得到重复回调，但此时滑动一个TableView时，RunLoop 会将 mode 切换为 TrackingRunLoopMode，这时 Timer 就不会被回调，并且也不会影响到滑动操作。</li>
<li><strong>有时</strong>你需要一个 Timer，在两个 Mode 中都能得到回调，一种办法就是将这个 Timer 分别加入这两个 Mode。还有一种方式，就是将 Timer 加入到顶层的 RunLoop 的 “commonModeItems” 中。”commonModeItems” 被 RunLoop 自动更新到所有具有”Common”属性的 Mode 里去。</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1438251-c7ec37c71f64a250.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="runloop.png"><br>一个 RunLoop 包含若干个 Mode，每个 Mode 又包含若干个 Source/Timer/Observer。每次调用 RunLoop 的主函数时，只能指定其中一个 Mode，这个Mode被称作 CurrentMode。如果需要切换 Mode，只能退出 Loop，再重新指定一个 Mode 进入。这样做主要是为了分隔开不同组的 Source/Timer/Observer，让其互不影响。</p>
<h1 id="4-CFRunLoopModelRef："><a href="#4-CFRunLoopModelRef：" class="headerlink" title="4. CFRunLoopModelRef："></a>4. CFRunLoopModelRef：</h1><ul>
<li><strong>数据构造</strong> （见上）</li>
<li><strong>创建与添加</strong> ：runloop自动创建对应的mode；mode只能添加不能删除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CFRunLoopAddCommonMode(CFRunLoopRef runloop, CFStringRef modeName);// 添加mode</div></pre></td></tr></table></figure>
<ul>
<li><strong>类型</strong> ：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1. kCFRunLoopDefaultMode: 默认 mode，通常主线程在这个 Mode 下运行。</div><div class="line">2. UITrackingRunLoopMode: 追踪mode，保证Scrollview滑动顺畅不受其他 mode 影响。</div><div class="line">3. UIInitializationRunLoopMode: 启动程序后的过渡mode，启动完成后就不再使用。</div><div class="line">4: GSEventReceiveRunLoopMode: Graphic相关事件的mode，通常用不到。</div><div class="line">5: kCFRunLoopCommonModes: 占位mode，作为标记DefaultMode和CommonMode用。</div></pre></td></tr></table></figure>
<ul>
<li><strong>modeItems</strong> ：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 添加移除item的函数（参数：添加/移除哪个item到哪个runloop的哪个mode下）CFRunLoopAddSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);</div><div class="line">CFRunLoopAddObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);</div><div class="line">CFRunLoopAddTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode);</div><div class="line">CFRunLoopRemoveSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);</div><div class="line">CFRunLoopRemoveObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);</div><div class="line">CFRunLoopRemoveTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode);</div></pre></td></tr></table></figure>
<p>你<strong>只能</strong>通过 mode name 来操作内部的 mode，当你传入一个新的 mode name 但 RunLoop 内部没有对应 mode 时，RunLoop会自动帮你创建对应的 CFRunLoopModeRef。对于一个 RunLoop 来说，其内部的 mode 只能增加不能删除。<br>苹果<strong>公开</strong>提供的 Mode 有两个：kCFRunLoopDefaultMode (NSDefaultRunLoopMode) 和 UITrackingRunLoopMode，你可以用这两个 Mode Name 来操作其对应的 Mode。<br>同时苹果还提供了一个操作 <strong>Common</strong> 标记的字符串：kCFRunLoopCommonModes (NSRunLoopCommonModes)，你可以用这个字符串来操作 Common Items，或标记一个 Mode 为 “Common”。使用时注意区分这个字符串和其他 mode name。</p>
<h2 id="4-1-CFRunLoopSourceRef"><a href="#4-1-CFRunLoopSourceRef" class="headerlink" title="4.1 CFRunLoopSourceRef:"></a>4.1 CFRunLoopSourceRef:</h2><ul>
<li><strong>数据构造</strong> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// source0 (manual): order(优先级)，callout(回调函数)</div><div class="line">CFRunLoopSource &#123;order =..., &#123;callout =... &#125;&#125;</div><div class="line">// source1 (mach port)：order(优先级)，port:(端口), callout(回调函数)</div><div class="line">CFRunLoopSource &#123;order = ..., &#123;port = ..., callout =...&#125;</div></pre></td></tr></table></figure>
<p>• <em>Source0</em> 只包含了一个回调（函数指针），它并不能主动触发事件。使用时，你需要先调用 CFRunLoopSourceSignal(source)，将这个 Source 标记为待处理，然后手动调用 CFRunLoopWakeUp(runloop) 来唤醒 RunLoop，让其处理这个事件。<br>• <em>Source1</em> 包含了一个 mach_port 和一个回调（函数指针），被用于通过内核和其他线程相互发送消息。这种 Source 能主动唤醒 RunLoop 的线程，其原理在下面会讲到。</p>
<h2 id="4-2-CFRunLoopTimerRef"><a href="#4-2-CFRunLoopTimerRef" class="headerlink" title="4.2 CFRunLoopTimerRef:"></a>4.2 CFRunLoopTimerRef:</h2><ul>
<li><p><strong>CFRunLoopTimerRef</strong> 是基于时间的触发器，它和 NSTimer 是toll-free bridged 的，可以混用。其包含一个时间长度和一个回调（函数指针）。当其加入到 RunLoop 时，RunLoop会注册对应的时间点，当时间点到时，RunLoop会被唤醒以执行那个回调。</p>
</li>
<li><p><strong>数据构造</strong> </p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// Timer：interval:(闹钟间隔), tolerance:(延期时间容忍度)，callout(回调函数)</div><div class="line">CFRunLoopTimer &#123;firing =..., interval = ...,tolerance = ...,next fire date = ...,callout = ...&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>创建与生效</strong> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//NSTimer：// 创建一个定时器（需要手动加到runloop的mode中）</div><div class="line">+ (NSTimer *)timerWithTimeInterval:(NSTimeInterval)ti invocation:(NSInvocation *)invocation repeats:(BOOL)yesOrNo; // 默认已经添加到主线程的runLoop的DefaultMode中 </div><div class="line">+ (NSTimer *)scheduledTimerWithTimeInterval:(NSTimeInterval)ti invocation:(NSInvocation *)invocation repeats:(BOOL)yesOrNo;// performSEL方法// 内部会创建一个Timer到当前线程的runloop中（如果当前线程没runloop则方法无效；performSelector:onThread: 方法放到指定线程runloop中）</div><div class="line">- (void)performSelector:(SEL)aSelector withObject:(id)anArgument afterDelay:(NSTimeInterval)delay</div></pre></td></tr></table></figure>
<ul>
<li><strong>相关类型（GCD的timer与CADisplayLink)</strong><br><em>GCD的timer</em>：dispatch_source_t 类型，可以精确的参数，不用以来runloop和mode，性能消耗更小。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dispatch_source_set_timer(dispatch_source_t source, // 定时器对象dispatch_time_t start, // 定时器开始执行的时间uint64_t interval, // 定时器的间隔时间uint64_t leeway // 定时器的精度 );</div></pre></td></tr></table></figure>
<p>  <em>CADisplayLink</em> ：Timer的tolerance表示最大延期时间，如果因为阻塞错过了这个时间精度，这个时间点的回调也会跳过去，不会延后执行。CADisplayLink 是一个和屏幕刷新率一致的定时器，如果在两次屏幕刷新之间执行了一个长任务，那其中就会有一帧被跳过去（和 NSTimer 相似，只是没有tolerance容忍时间），造成界面卡顿的感觉。</p>
<h2 id="4-3-CFRunLoopObserverRef"><a href="#4-3-CFRunLoopObserverRef" class="headerlink" title="4.3 CFRunLoopObserverRef:"></a>4.3 CFRunLoopObserverRef:</h2><p>监听runloop状态，接收回调信息（常见于自动释放池创建销毁）</p>
<ul>
<li><strong>数据构造</strong> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// Observer：order(优先级)，ativity(监听状态)，callout(回调函数)</div><div class="line">CFRunLoopObserver &#123;order = ..., activities = ..., callout = ...&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>创建与添加</strong> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 第一个参数用于分配该observer对象的内存空间</div><div class="line">// 第二个参数用以设置该observer监听什么状态</div><div class="line">// 第三个参数用于标识该observer是在第一次进入run loop时执行还是每次进入run loop处理时均执行</div><div class="line">// 第四个参数用于设置该observer的优先级,一般为0</div><div class="line">// 第五个参数用于设置该observer的回调函数</div><div class="line">// 第六个参数observer的运行状态 CFRunLoopObserverCreateWithHandler(CFAllocatorGetDefault(), kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) &#123; // 执行代码&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>监听的状态</strong> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; kCFRunLoopEntry = (1UL &lt;&lt; 0), // 即将进入Loop kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), // 即将处理 Timer kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), // 即将处理 Source kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), // 即将进入休眠 kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), // 刚从休眠中唤醒 kCFRunLoopExit = (1UL &lt;&lt; 7), // 即将退出Loop&#125;;</div></pre></td></tr></table></figure>
<h1 id="5-RunLoop-内部逻辑："><a href="#5-RunLoop-内部逻辑：" class="headerlink" title="5. RunLoop 内部逻辑："></a>5. RunLoop 内部逻辑：</h1><p>   关键在两个判断点（是否睡觉，是否退出）</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1438251-e20fc9bc0bdd00c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="RunLoop_1.png"></p>
<ul>
<li><strong>代码实现</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">// RunLoop的实现int CFRunLoopRunSpecific(runloop, modeName, seconds, stopAfterHandle) &#123; </div><div class="line">// 0.1 根据modeName找到对应mode </div><div class="line">CFRunLoopModeRef currentMode = __CFRunLoopFindMode(runloop, modeName, false); </div><div class="line">// 0.2 如果mode里没有source/timer/observer, 直接返回。if (__CFRunLoopModeIsEmpty(currentMode)) return; </div><div class="line">// 1.1 通知 Observers: RunLoop 即将进入 loop。---（OB会创建释放池）__CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopEntry); </div><div class="line">// 1.2 内部函数，进入loop__CFRunLoopRun(runloop, currentMode, seconds, returnAfterSourceHandled) &#123;</div><div class="line">Boolean sourceHandledThisLoop = NO;</div><div class="line">int retVal = 0; </div><div class="line">do &#123; </div><div class="line">// 2.1 通知 Observers: RunLoop 即将触发 Timer 回调。__CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeTimers); </div><div class="line">// 2.2 通知 Observers: RunLoop 即将触发 Source0 (非port) 回调。__CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeSources); </div><div class="line">// 执行被加入的block__CFRunLoopDoBlocks(runloop, currentMode); </div><div class="line"></div><div class="line">// 2.3 RunLoop 触发 Source0 (非port) 回调。</div><div class="line">sourceHandledThisLoop = __CFRunLoopDoSources0(runloop, currentMode, stopAfterHandle); </div><div class="line">// 执行被加入的block__CFRunLoopDoBlocks(runloop, currentMode); </div><div class="line"></div><div class="line">// 2.4 如果有 Source1 (基于port) 处于 ready 状态，直接处理这个 Source1 然后跳转去处理消息。if (__Source0DidDispatchPortLastTime) &#123;</div><div class="line">Boolean hasMsg = __CFRunLoopServiceMachPort(dispatchPort, &amp;msg) </div><div class="line">if (hasMsg) goto handle_msg; &#125; </div><div class="line"></div><div class="line">// 3.1 如果没有待处理消息，通知 Observers: RunLoop 的线程即将进入休眠(sleep)。--- (OB会销毁释放池并建立新释放池)if (!sourceHandledThisLoop) &#123; </div><div class="line">__CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeWaiting); &#125; </div><div class="line"></div><div class="line">// 3.2. 调用 mach_msg 等待接受 mach_port 的消息。线程将进入休眠, 直到被下面某一个事件唤醒。// - 一个基于 port 的Source1 的事件。// - 一个 Timer 到时间了// - RunLoop 启动时设置的最大超时时间到了// - 被手动唤醒__CFRunLoopServiceMachPort(waitSet, &amp;msg, sizeof(msg_buffer), &amp;livePort) &#123; </div><div class="line">mach_msg(msg, MACH_RCV_MSG, port); // thread wait for receive msg &#125; </div><div class="line"></div><div class="line">// 3.3. 被唤醒，通知 Observers: RunLoop 的线程刚刚被唤醒了。__CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopAfterWaiting); </div><div class="line"></div><div class="line">// 4.0 处理消息。</div><div class="line">handle_msg: </div><div class="line"></div><div class="line">// 4.1 如果消息是Timer类型，触发这个Timer的回调。</div><div class="line">if (msg_is_timer) &#123; </div><div class="line">__CFRunLoopDoTimers(runloop, currentMode, mach_absolute_time()) &#125; </div><div class="line"></div><div class="line">// 4.2 如果消息是dispatch到main_queue的block，执行block。</div><div class="line">else if (msg_is_dispatch) &#123; __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(msg); &#125;</div><div class="line"></div><div class="line">// 4.3 如果消息是Source1类型，处理这个事件</div><div class="line">else &#123; </div><div class="line">CFRunLoopSourceRef source1 = __CFRunLoopModeFindSourceForMachPort(runloop, currentMode, livePort); </div><div class="line">sourceHandledThisLoop = __CFRunLoopDoSource1(runloop, currentMode, source1, msg); </div><div class="line">if (sourceHandledThisLoop) &#123;</div><div class="line">mach_msg(reply, MACH_SEND_MSG, reply); &#125; &#125; </div><div class="line"></div><div class="line">// 执行加入到Loop的block__CFRunLoopDoBlocks(runloop, currentMode); </div><div class="line"></div><div class="line">// 5.1 如果处理事件完毕，启动Runloop时设置参数为一次性执行,设置while参数退出Runloopif (sourceHandledThisLoop &amp;&amp; stopAfterHandle) &#123; </div><div class="line">retVal = kCFRunLoopRunHandledSource; </div><div class="line">// 5.2 如果启动Runloop时设置的最大运转时间到期，设置while参数退出Runloop </div><div class="line">&#125;  else if (timeout) &#123; </div><div class="line">retVal = kCFRunLoopRunTimedOut; </div><div class="line">// 5.3 如果启动Runloop被外部调用强制停止，设置while参数退出Runloop </div><div class="line">&#125; else if (__CFRunLoopIsStopped(runloop)) &#123; </div><div class="line">retVal = kCFRunLoopRunStopped; </div><div class="line">// 5.4 如果启动Runloop的modeItems为空，设置while参数退出Runloop </div><div class="line">&#125; else if (__CFRunLoopModeIsEmpty(runloop, currentMode)) &#123;</div><div class="line">retVal = kCFRunLoopRunFinished; &#125;</div><div class="line">// 5.5 如果没超时，mode里没空，loop也没被停止，那继续loop，回到第2步循环。</div><div class="line">&#125; while (retVal == 0); &#125; </div><div class="line">// 6. 如果第6步判断后loop退出，通知 Observers: RunLoop 退出。--- (OB会销毁新释放池)__CFRunLoopDoObservers(rl, currentMode, kCFRunLoopExit);</div><div class="line">&#125;</div><div class="line"></div><div class="line">``` </div><div class="line">* **简化实现过程**</div></pre></td></tr></table></figure>
<p>1- Entry：通知OB（创建pool）；<br>2- 执行阶段：按顺序通知OB并执行timer，source0；若有source1执行source1；<br>3- 休眠阶段：利用mach_msg判断进入休眠，通知OB（pool的销毁重建）；被消息唤醒通知OB；<br>4- 执行阶段：按消息类型处理事件；<br>5- 判断退出条件：如果符合退出条件（一次性执行，超时，强制停止，modeItem为空）则退出，否则回到第2阶段；<br>6- Exit：通知OB（销毁pool）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># 6. RunLoop 本质：mach port和mach_msg()</div></pre></td></tr></table></figure></p>
<p>Mach是XNU的内核，进程、线程和虚拟内存等对象通过端口发消息进行通信，Runloop通过mach_msg()函数发送消息，如果没有port 消息，内核会将线程置于等待状态 mach_msg_trap() 。<br>如果有消息，判断消息类型处理事件，并通过modeItem的callback回调。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># 7. RunLoop如何处理事件（举例</div><div class="line"></div><div class="line">* **界面刷新**</div></pre></td></tr></table></figure></p>
<p>当UI改变（ Frame变化、 UIView/CALayer 的继承结构变化等）时，或手动调用了 UIView/CALayer 的 setNeedsLayout/setNeedsDisplay方法后，这个 UIView/CALayer 就被标记为待处理。<br>苹果注册了一个用来监听BeforeWaiting和Exit的Observer，在它的回调函数里会遍历所有待处理的 UIView/CAlayer 以执行实际的绘制和调整，并更新 UI 界面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">* **事件响应**</div></pre></td></tr></table></figure>
<p>当一个硬件事件(触摸/锁屏/摇晃/加速等)发生后，首先由 IOKit.framework 生成一个 IOHIDEvent 事件并由 SpringBoard 接收， 随后由mach port 转发给需要的App进程。<br>苹果注册了一个 Source1 (基于 mach port 的) 来接收系统事件，通过回调函数触发Sourece0（所以UIEvent实际上是基于Source0的），<br>调用 _UIApplicationHandleEventQueue() 进行应用内部的分发。_UIApplicationHandleEventQueue() 会把 IOHIDEvent 处理并包装成 UIEvent 进行处理或分发，其中包括识别 UIGesture/处理屏幕旋转/发送给 UIWindow 等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">* **手势识别**</div></pre></td></tr></table></figure>
<p>如果上一步的 _UIApplicationHandleEventQueue() 识别到是一个guesture手势，会调用Cancel方法将当前的touchesBegin/Move/End 系列回调打断。随后系统将对应的 UIGestureRecognizer 标记为待处理。<br>苹果注册了一个 Observer 监测 BeforeWaiting (Loop即将进入休眠) 事件，其回调函数为 _UIGestureRecognizerUpdateObserver()，其内部会获取所有刚被标记为待处理的 GestureRecognizer，并执行GestureRecognizer的回调。<br>当有 UIGestureRecognizer 的变化(创建/销毁/状态改变)时，这个回调都会进行相应处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">* **GCD任务**</div></pre></td></tr></table></figure>
<p>当调用 dispatch_async(dispatch_get_main_queue(), block) 时，libDispatch 会向主线程的 RunLoop 发送消息，RunLoop会被唤醒，并从消息中取得这个 block，并在回调里执行这个 block。Runloop只处理主线程的block，dispatch 到其他线程仍然是由 libDispatch 处理的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">* **网络请求**</div></pre></td></tr></table></figure>
<p>关于网络请求的接口:最底层是CFSocket层，然后是CFNetwork将其封装，然后是NSURLConnection对CFNetwork进行面向对象的封装，NSURLSession 是 iOS7 中新增的接口，也用到NSURLConnection的loader线程。所以还是以NSURLConnection为例。<br>当开始网络传输时，NSURLConnection 创建了两个新线程：com.apple.NSURLConnectionLoader 和 com.apple.CFSocket.private。其中 CFSocket 线程是处理底层 socket 连接的。NSURLConnectionLoader 这个线程内部会使用 RunLoop 来接收底层 socket 的事件，并通过之前添加的 Source0 通知到上层的 Delegate。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">![666982-9bf4831b87769d5a.png](http://upload-images.jianshu.io/upload_images/1438251-974107aba47b23f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</div><div class="line"></div><div class="line"># 8.应用</div><div class="line"></div><div class="line">* **滑动与图片刷新**</div><div class="line"></div><div class="line">当tableview的cell上有需要从网络获取的图片的时候，滚动tableView，异步线程会去加载图片，加载完成后主线程就会设置cell的图片，但是会造成卡顿。可以让设置图片的任务在CFRunLoopDefaultMode下进行，当滚动tableView的时候，RunLoop是在 UITrackingRunLoopMode 下进行，不去设置图片，而是当停止的时候，再去设置图片。</div></pre></td></tr></table></figure>
<ul>
<li>(void)viewDidLoad {<br>[super viewDidLoad];<br>// 只在NSDefaultRunLoopMode下执行(刷新图片)<br>[self.myImageView performSelector:@selector(setImage:) withObject:[UIImage imageNamed:@””] afterDelay:ti inModes:@[NSDefaultRunLoopMode]];<br>}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">* **常驻子线程，保持子线程一直处理事件**</div><div class="line">为了保证线程长期运转，可以在子线程中加入RunLoop，并且给Runloop设置item，防止Runloop自动退出。</div></pre></td></tr></table></figure>
<ul>
<li>(void)networkRequestThreadEntryPoint:(id)__unused object {<br>@autoreleasepool {<br>[[NSThread currentThread] setName:@”AFNetworking”];<br>NSRunLoop *runLoop = [NSRunLoop currentRunLoop];<br>[runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];<br>[runLoop run];<br>}<br>}</li>
<li>(NSThread <em>)networkRequestThread {<br>static NSThread </em>_networkRequestThread = nil;<br>static dispatch_once_t oncePredicate;<br>dispatch_once(&amp;oncePredicate, ^{<br>_networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint:) object:nil];<br>[_networkRequestThread start]; });<br>return _networkRequestThread;}</li>
</ul>
<ul>
<li>(void)start {<br>[self.lock lock];<br>if ([self isCancelled]) {<br>[self performSelector:@selector(cancelConnection) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]];<br>} else if ([self isReady]) {<br>self.state = AFOperationExecutingState;<br>[self performSelector:@selector(operationDidStart) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]];<br>}<br>[self.lock unlock];<br>}</li>
</ul>
<p>```</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/03/07/荼菜的iOS笔记-精解RunLoop笔记/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-荼菜的iOS笔记-iOS自动打包" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/02/荼菜的iOS笔记-iOS自动打包/">荼菜的iOS笔记--iOS自动打包</a>
    </h1>
  

        
        <a href="/2016/12/02/荼菜的iOS笔记-iOS自动打包/" class="archive-article-date">
  	<time datetime="2016-12-02T13:34:02.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-12-02</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-cdd88014a03d8731.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="脚本"></p>
<p><strong>最近几天学Python，顺便写了个自动打包的脚本，给大家做个参考。注释和步骤代码里都写得有，使用时把工程路径换了就行。可以直接拷贝到你的.py文件里执行。当然你还可以来我的GitHub直接下载文件<a href="https://github.com/ganyang-eyespage/Python_Archiveipa" target="_blank" rel="external">Python_Archiveipa</a></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line">import os</div><div class="line">import sys</div><div class="line">import time</div><div class="line">import hashlib</div><div class="line">from email import encoders</div><div class="line">from email.header import Header</div><div class="line">from email.mime.text import MIMEText</div><div class="line">from email.utils import parseaddr, formataddr</div><div class="line">import smtplib</div><div class="line"></div><div class="line"># 项目根目录</div><div class="line">project_path = &apos;/Users/yanggan/Desktop/jucai-ios-app&apos;</div><div class="line"># 编译成功后.app所在目录  其中&apos;/Users/yanggan/Desktop/jucai-ios-app&apos;为项目路径</div><div class="line">app_path = &apos;%s/build/Build/Products/Release-iphoneos/JuCaiShengHuo.app&apos; % (project_path)</div><div class="line"># 指定项目下编译目录</div><div class="line">build_path = &apos;build&apos;</div><div class="line"># 打包后ipa存储目录</div><div class="line">targerIPA_parth = &apos;/Users/yanggan/Desktop&apos;</div><div class="line"></div><div class="line"># 项目名称</div><div class="line">project_name = &apos;JuCaiShengHuo&apos;</div><div class="line"></div><div class="line"># ipafilename</div><div class="line">ipa_filename = &apos;JuCaiShengHuo.ipa&apos;</div><div class="line"></div><div class="line"># firm的api token  需要自己申请账号，申请地址-&gt;  http://fir.im/apps</div><div class="line">fir_api_token = &apos;4a0d2512c33d0a10ca0e59dbd04b45b0&apos;</div><div class="line"></div><div class="line"># 需要自己配置邮件端口号，服务器和对方邮箱地址</div><div class="line">#from_addr = &quot;邮件地址&quot;</div><div class="line">#password = &quot;邮件密码&quot;</div><div class="line">#smtp_server = &quot;smtp.服务器&quot;</div><div class="line">#to_addr = &quot;对方邮件地址&quot;</div><div class="line"></div><div class="line"># 清理项目 创建build目录</div><div class="line">def clean_project_mkdir_build():</div><div class="line">    os.system(&apos;cd %s;xcodebuild clean&apos; % project_path) # clean 项目</div><div class="line">    os.system(&apos;cd %s;mkdir build&apos; % project_path)</div><div class="line"></div><div class="line">def build_project():</div><div class="line">    print(&apos;build release start&apos;)</div><div class="line">    os.system (&apos;xcodebuild -list&apos;)</div><div class="line">    os.system (&apos;cd %s;xcodebuild -workspace %s.xcworkspace  -scheme %s -configuration release -derivedDataPath %s ONLY_ACTIVE_ARCH=NO || exit&apos; % (project_path,project_name,project_name,build_path))</div><div class="line"># CONFIGURATION_BUILD_DIR=./build/Release-iphoneos</div><div class="line"></div><div class="line"># 打包ipa 并且保存在桌面</div><div class="line">def build_ipa():</div><div class="line">    global ipa_filename</div><div class="line">#    ipa_filename = time.strftime(&apos;xx_%Y-%m-%d-%H-%M-%S.ipa&apos;,time.localtime(time.time()))</div><div class="line">    os.system (&apos;xcrun -sdk iphoneos PackageApplication -v %s -o %s/%s&apos;%(app_path,targerIPA_parth,ipa_filename))</div><div class="line">#上传</div><div class="line">def upload_fir():</div><div class="line">    if os.path.exists(&apos;%s/%s&apos; % (targerIPA_parth,ipa_filename)):</div><div class="line">        print(&apos;watting...&apos;)</div><div class="line">        # 直接使用fir 有问题 这里使用了绝对地址 在终端通过 which fir 获得</div><div class="line">        ret = os.system(&apos;fir p %s/%s -T %s&apos; % (targerIPA_parth,ipa_filename,fir_api_token))</div><div class="line">    else:</div><div class="line">        print(&apos;没有找到ipa文件&apos;)</div><div class="line"></div><div class="line">def _format_addr(s):</div><div class="line">    name, addr = parseaddr(s)</div><div class="line">    return formataddr((Header(name, &apos;utf-8&apos;).encode(), addr))</div><div class="line"></div><div class="line"># 发邮件</div><div class="line">def send_mail():</div><div class="line">    msg = MIMEText(&apos;xx iOS测试项目已经打包完毕，请前往 http://fir.im/xxxxx 下载测试！&apos;, &apos;plain&apos;, &apos;utf-8&apos;)</div><div class="line">    msg[&apos;From&apos;] = _format_addr(&apos;自动打包系统 &lt;%s&gt;&apos; % from_addr)</div><div class="line">    msg[&apos;To&apos;] = _format_addr(&apos;xx测试人员 &lt;%s&gt;&apos; % to_addr)</div><div class="line">    msg[&apos;Subject&apos;] = Header(&apos;xx iOS客户端打包程序&apos;, &apos;utf-8&apos;).encode()</div><div class="line"></div><div class="line">#    pop = poplib.POP3(&quot;pop3.mxhichina.com&quot;)</div><div class="line">#    pop.set_debuglevel(1)            #会打印出debug信息</div><div class="line">#    pop.user(from_addr)</div><div class="line">#    pop.pass_(password)</div><div class="line"></div><div class="line">    server = smtplib.SMTP(smtp_server, 25)</div><div class="line">    server.set_debuglevel(1)</div><div class="line">    server.login(from_addr, password)</div><div class="line">    server.sendmail(from_addr, [to_addr], msg.as_string())</div><div class="line">    server.quit()</div><div class="line"></div><div class="line">def main():</div><div class="line">    # 清理并创建build目录</div><div class="line">    clean_project_mkdir_build()</div><div class="line">    # 编译coocaPods项目文件并 执行编译目录</div><div class="line">    build_project()</div><div class="line">    # 打包ipa 并制定到桌面</div><div class="line">    build_ipa()</div><div class="line">    # 上传fir</div><div class="line">    # upload_fir()</div><div class="line">    # 发邮件</div><div class="line">#    send_mail() #暂时不用，需要配置企业邮箱的端口号和服务器</div><div class="line"></div><div class="line"># 执行</div><div class="line">main()</div></pre></td></tr></table></figure>
<hr>
<p><strong>后话：附上之前写的文章，欢迎指正：</strong><br><a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画
</a><br><a href="http://www.jianshu.com/p/88e20ba25eb9" target="_blank" rel="external">荼菜的iOS笔记–UIView的几个Block动画</a><br><a href="http://www.jianshu.com/p/1cff3fe34307" target="_blank" rel="external">荼菜的iOS笔记–一些实用功能。</a><br><a href="http://www.jianshu.com/p/fa53a2ffc0c6" target="_blank" rel="external">荼菜的iOS笔记–UITableViewCell的各种操作（刷新、插入、删除、动画）</a><br><a href="http://www.jianshu.com/p/6b850e1e6306" target="_blank" rel="external">荼菜的iOS笔记–一张图记住所有git命令行操作。</a><br><a href="http://www.jianshu.com/p/36346ccc1b92" target="_blank" rel="external">荼菜的iOS笔记–一张图告诉你程序员需要知道的这些网站。</a><br><a href="http://www.jianshu.com/p/77ca88d36682" target="_blank" rel="external">荼菜的iOS笔记–图片裁剪黑魔法。</a><br><a href="http://www.jianshu.com/p/36b6443d5ad7" target="_blank" rel="external">荼菜的iOS笔记–我的编码规范参考。</a><br><a href="http://www.jianshu.com/p/3812ede99dca" target="_blank" rel="external">荼菜的iOS笔记–iOS基础优秀博客总结ToDoList</a><br><a href="http://www.jianshu.com/p/191b20c40143" target="_blank" rel="external">荼菜的iOS笔记–Xcode Tips</a><br><strong>当然，我还写过诗。。。</strong><br><a href="http://www.jianshu.com/p/f6927319f802" target="_blank" rel="external">光。</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/12/02/荼菜的iOS笔记-iOS自动打包/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-荼菜的iOS笔记-我的编码规范参考" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/02/荼菜的iOS笔记-我的编码规范参考/">荼菜的iOS笔记--我的编码规范参考.</a>
    </h1>
  

        
        <a href="/2016/12/02/荼菜的iOS笔记-我的编码规范参考/" class="archive-article-date">
  	<time datetime="2016-12-02T08:38:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-12-02</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-72cf86b265f1fc67.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="what&#39;s wrong?"></p>
<p><strong>前言：下面是我的编码习惯。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#一、常量</div><div class="line">相对字符串字面量或数字，我们更推荐适用常量。应使用static方式声明常量，而非使用#define的方式来定义宏。</div><div class="line">例如：</div><div class="line">static NSString * const NYTAboutViewControllerCompanyName = @&quot;The New York Times Company&quot;;  </div><div class="line">static const CGFloat NYTImageThumbnailHeight = 50.0;</div><div class="line">不恰当:</div><div class="line">//#define CompanyName @&quot;The New York Times Company&quot;</div><div class="line">//#define thumbnailHeight 2</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#二、枚举类型</div><div class="line">在使用enum的时候，推荐适用最新的fixed underlying type(WWDC 2012 session 405- Modern Objective-C)规范，因为它具备更强的类型检查和代码完成功能。</div><div class="line">如：</div><div class="line">typedef NS_ENUM(NSInteger, NYTAdRequestState) &#123;</div><div class="line">NYTAdRequestStateInactive,</div><div class="line">NYTAdRequestStateLoading</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#三、布尔变量</div><div class="line">如果一个BOOL属性使用形容词来表达，属性将忽略’is’前缀，但会强调惯用名称。 例如：</div><div class="line">@property (assign, getter=isEditable) BOOL editable;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#四、单例</div><div class="line">在创建单例对象的共享实例时，应使用线程安全模式。</div><div class="line">如：</div><div class="line">(instancetype)sharedInstance &#123;</div><div class="line">static id sharedInstance = nil;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">sharedInstance = [[self alloc] init];</div><div class="line">&#125;);</div><div class="line">return sharedInstance;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#五、Import</div><div class="line">在类的头文件中需要引用其他的类的时候，需要用@class这个关键字，这样能减少类与类之间的依赖。</div><div class="line">如:</div><div class="line">store.h:</div><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">#import &lt;CoreData/CoreData.h&gt;</div><div class="line">@class User;</div><div class="line">@interface Store : NSManagedObject</div><div class="line">@property (nonatomic, retain) User *user;</div><div class="line">@end</div><div class="line">Store.m:</div><div class="line">#import &quot;Store.h&quot;</div><div class="line">#import &quot;User.h&quot;</div><div class="line">@implementation Store</div><div class="line">//doSomething</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#六、CGRect函数</div><div class="line">当需要获取一个CGRect矩形的x,y,width,height属性时，应使用CGGeometry函数，而非直接访问结构体成员。</div><div class="line">如：</div><div class="line">CGRect frame = self.view.frame;</div><div class="line">CGFloat x = CGRectGetMinX(frame);</div><div class="line">CGFloat y = CGRectGetMinY(frame);</div><div class="line">CGFloat width = CGRectGetWidth(frame);</div><div class="line">CGFloat height = CGRectGetHeight(frame);</div><div class="line">不恰当：</div><div class="line">CGRect frame = self.view.frame;</div><div class="line">CGFloat x = frame.origin.x;</div><div class="line">CGFloat y = frame.origin.y;</div><div class="line">CGFloat width = frame.size.width;</div><div class="line">CGFloat height = frame.size.height;</div></pre></td></tr></table></figure>
<hr>
<p><strong>后话：附上之前写的文章，欢迎指正：</strong><br><a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画
</a><br><a href="http://www.jianshu.com/p/88e20ba25eb9" target="_blank" rel="external">荼菜的iOS笔记–UIView的几个Block动画</a><br><a href="http://www.jianshu.com/p/1cff3fe34307" target="_blank" rel="external">荼菜的iOS笔记–一些实用功能。</a><br><a href="http://www.jianshu.com/p/fa53a2ffc0c6" target="_blank" rel="external">荼菜的iOS笔记–UITableViewCell的各种操作（刷新、插入、删除、动画）</a><br><a href="http://www.jianshu.com/p/6b850e1e6306" target="_blank" rel="external">荼菜的iOS笔记–一张图记住所有git命令行操作。</a><br><a href="http://www.jianshu.com/p/36346ccc1b92" target="_blank" rel="external">荼菜的iOS笔记–一张图告诉你程序员需要知道的这些网站。</a><br><a href="http://www.jianshu.com/p/77ca88d36682" target="_blank" rel="external">荼菜的iOS笔记–图片裁剪黑魔法。</a><br><a href="http://www.jianshu.com/p/443c60408035" target="_blank" rel="external">荼菜的iOS笔记–iOS自动打包脚本（Python）
</a><br><a href="http://www.jianshu.com/p/3812ede99dca" target="_blank" rel="external">荼菜的iOS笔记–iOS基础优秀博客总结ToDoList</a><br><a href="http://www.jianshu.com/p/191b20c40143" target="_blank" rel="external">荼菜的iOS笔记–Xcode Tips</a><br><strong>当然，我还写过诗。。。</strong><br><a href="http://www.jianshu.com/p/f6927319f802" target="_blank" rel="external">光。</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/12/02/荼菜的iOS笔记-我的编码规范参考/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-荼菜的iOS笔记-UIView的几个Block动画" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/08/荼菜的iOS笔记-UIView的几个Block动画/">荼菜的iOS笔记--UIView的几个Block动画</a>
    </h1>
  

        
        <a href="/2016/09/08/荼菜的iOS笔记-UIView的几个Block动画/" class="archive-article-date">
  	<time datetime="2016-09-08T11:34:19.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-09-08</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-7ad2c344d6f9bbaf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="二"><br><strong>前言：我的第一篇文章<a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画</a></strong>算是比较详细讲了核心动画的用法，但是如你上篇看到的，有时我们只是想实现一些很小的动画，这时再用coreAnimation就会觉得麻烦，不用慌，苹果工程师爸爸们已经为我们给UIView封装好了一些coreAnimationBlock，足以满足平时的动画需求。</p>
<ul>
<li><strong>动画Block1</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/* </div><div class="line">参数1: Duration: 动画持续时间</div><div class="line">参数2: delay: 延迟时间</div><div class="line">参数3: options: 枚举值 动画的效果类型</div><div class="line">*/</div><div class="line">[UIView animateWithDuration:2 delay:1 options:UIViewAnimationOptionCurveEaseInOut animations:^&#123;</div><div class="line">ws.MyLabel.frame = CGRectMake(100, 100, 100, 100);</div><div class="line">&#125; completion:^(BOOL finished) &#123;</div><div class="line">NSLog(@&quot;结束了%d&quot;, finished); </div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li><strong>动画Block2-(模拟弹簧弹跳的效果)</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">Spring: 模拟弹簧弹跳的效果</div><div class="line">参数: Damping:阻尼 0-1 阻尼越小动画越明显</div><div class="line">参数: initialSpringVelocity : 动画初始变化速度</div><div class="line">参数: options 转变的风格 枚举值</div><div class="line">*/</div><div class="line">[UIView animateWithDuration:10 delay:0 usingSpringWithDamping:0.1 initialSpringVelocity:15 options:(UIViewAnimationOptionCurveEaseInOut) animations:^&#123;</div><div class="line">ws.MyLabel.center = CGPointMake(self.view.center.x, 100);</div><div class="line">&#125; completion:^(BOOL finished) &#123;</div><div class="line">NSLog(@&quot;弹簧效果结束&quot;);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li><strong>动画Block3-(关键帧动画)</strong>也就是里面有好几个动画进行转变</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">Duration:持续时间</div><div class="line">delay: 延迟时间</div><div class="line">options: 枚举值 动画的风格</div><div class="line">*/</div><div class="line">[UIView animateKeyframesWithDuration:3 delay:0 options:(UIViewKeyframeAnimationOptionRepeat) animations:^&#123;</div><div class="line">/*</div><div class="line">参数1: RelativeStartTime: 相对的开始时间</div><div class="line">参数2: relativeDuration:相对持续时间</div><div class="line">*/</div><div class="line">[UIView addKeyframeWithRelativeStartTime:0.0 relativeDuration:0.5 animations:^&#123;</div><div class="line">ws.MyLabel.center = self.view.center;</div><div class="line">&#125;];</div><div class="line">[UIView addKeyframeWithRelativeStartTime:0.5 relativeDuration:0.3 animations:^&#123;</div><div class="line">ws.MyLabel.frame = CGRectMake(100, 100, 100, 100);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">[UIView addKeyframeWithRelativeStartTime:0.8 relativeDuration:0.3 animations:^&#123;</div><div class="line">ws.MyLabel.frame = CGRectMake(100, 400, 100, 100);</div><div class="line">&#125;]; </div><div class="line">&#125; completion:^(BOOL finished) &#123;</div><div class="line">NSLog(@&quot;开始了吗？已经结束了。。&quot;);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li><strong>Masonry动画更新约束</strong><br>1.有时不适用<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[ws.allWarpView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">make.left.equalTo(ws.view.mas_left);</div><div class="line">make.right.equalTo(ws.view.mas_right);</div><div class="line">make.top.equalTo(ws.view.mas_top);</div><div class="line">make.bottom.equalTo(ws.view.mas_bottom);</div><div class="line">&#125;];</div><div class="line">// 告诉self.view约束需要更新</div><div class="line">[self.view setNeedsUpdateConstraints];</div><div class="line">// 调用此方法告诉self.view检测是否需要更新约束，若需要则更新，下面添加动画效果才起作用</div><div class="line">[self.view updateConstraintsIfNeeded];</div><div class="line">[UIView animateWithDuration:0.3 animations:^&#123;</div><div class="line">[self.view layoutIfNeeded];</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
</li>
</ul>
<p>2.解决<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">   [self layoutIfNeeded];//如果其约束还没有生成的时候需要动画的话，就请先强制刷新后才写动画，否则所有没生成的约束会直接跑动画</div><div class="line">    JCWeakSelf</div><div class="line">    [UIView animateWithDuration:0.3 animations:^&#123; </div><div class="line">        [_keywordTextField mas_updateConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">            make.width.mas_equalTo(@(255*RealScaleFactor));</div><div class="line">        &#125;];</div><div class="line">        [ws layoutIfNeeded];//强制绘制</div><div class="line">    &#125;];</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>后话：附上之前写的文章，欢迎指正：</strong><br><a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画
</a><br><a href="http://www.jianshu.com/p/1cff3fe34307" target="_blank" rel="external">荼菜的iOS笔记–一些实用功能。</a><br><a href="http://www.jianshu.com/p/fa53a2ffc0c6" target="_blank" rel="external">荼菜的iOS笔记–UITableViewCell的各种操作（刷新、插入、删除、动画）</a><br><a href="http://www.jianshu.com/p/6b850e1e6306" target="_blank" rel="external">荼菜的iOS笔记–一张图记住所有git命令行操作。</a><br><a href="http://www.jianshu.com/p/36346ccc1b92" target="_blank" rel="external">荼菜的iOS笔记–一张图告诉你程序员需要知道的这些网站。</a><br><a href="http://www.jianshu.com/p/77ca88d36682" target="_blank" rel="external">荼菜的iOS笔记–图片裁剪黑魔法。</a><br><a href="http://www.jianshu.com/p/443c60408035" target="_blank" rel="external">荼菜的iOS笔记–iOS自动打包脚本（Python）
</a><br><a href="http://www.jianshu.com/p/36b6443d5ad7" target="_blank" rel="external">荼菜的iOS笔记–我的编码规范参考。</a><br><a href="http://www.jianshu.com/p/3812ede99dca" target="_blank" rel="external">荼菜的iOS笔记–iOS基础优秀博客总结ToDoList</a><br><a href="http://www.jianshu.com/p/191b20c40143" target="_blank" rel="external">荼菜的iOS笔记–Xcode Tips</a><br><strong>当然，我还写过诗。。。</strong><br><a href="http://www.jianshu.com/p/f6927319f802" target="_blank" rel="external">光。</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/09/08/荼菜的iOS笔记-UIView的几个Block动画/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-荼菜的iOS笔记-Xcode-Tips" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/09/荼菜的iOS笔记-Xcode-Tips/">荼菜的iOS笔记--Xcode Tips</a>
    </h1>
  

        
        <a href="/2016/04/09/荼菜的iOS笔记-Xcode-Tips/" class="archive-article-date">
  	<time datetime="2016-04-09T02:14:23.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-04-09</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-e336f724e0f6dc43.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="winner.jpg"></p>
<p><strong>前言：孙源大神总结了几个 Xcode 小技巧，为方便自己查看遂自己拷贝一份</strong></p>
<p>#一、快速定位方法调用者<br><img src="http://upload-images.jianshu.io/upload_images/1438251-81e1c82d81c9a511.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="快速定位方法调用者"></p>
<p>#二、继续编译有Error的工程<br><img src="http://upload-images.jianshu.io/upload_images/1438251-de3266c329569cf6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="继续编译有Error的工程"></p>
<p>#三、给@prorerty设置断点<br><img src="http://upload-images.jianshu.io/upload_images/1438251-0f281e03f0e50bd1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="给@prorerty设置断点"></p>
<hr>
<p><strong>后话：附上之前写的文章，欢迎指正：</strong><br><a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画
 </a><br><a href="http://www.jianshu.com/p/88e20ba25eb9" target="_blank" rel="external">荼菜的iOS笔记–UIView的几个Block动画</a><br><a href="http://www.jianshu.com/p/1cff3fe34307" target="_blank" rel="external">荼菜的iOS笔记–一些实用功能。</a><br><a href="http://www.jianshu.com/p/fa53a2ffc0c6" target="_blank" rel="external">荼菜的iOS笔记–UITableViewCell的各种操作（刷新、插入、删除、动画）</a><br><a href="http://www.jianshu.com/p/6b850e1e6306" target="_blank" rel="external">荼菜的iOS笔记–一张图记住所有git命令行操作。</a><br><a href="http://www.jianshu.com/p/36346ccc1b92" target="_blank" rel="external">荼菜的iOS笔记–一张图告诉你程序员需要知道的这些网站。</a><br><a href="http://www.jianshu.com/p/77ca88d36682" target="_blank" rel="external">荼菜的iOS笔记–图片裁剪黑魔法。</a><br><a href="http://www.jianshu.com/p/443c60408035" target="_blank" rel="external">荼菜的iOS笔记–iOS自动打包脚本（Python）
 </a><br><a href="http://www.jianshu.com/p/36b6443d5ad7" target="_blank" rel="external">荼菜的iOS笔记–我的编码规范参考。</a><br><a href="http://www.jianshu.com/p/3812ede99dca" target="_blank" rel="external">荼菜的iOS笔记–iOS基础优秀博客总结ToDoList</a><br><strong>当然，我还写过诗。。。</strong><br><a href="http://www.jianshu.com/p/f6927319f802" target="_blank" rel="external">光。</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/04/09/荼菜的iOS笔记-Xcode-Tips/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-荼菜的iOS笔记-UITableViewCell的各种操作（刷新、插入、删除、动画）" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/02/荼菜的iOS笔记-UITableViewCell的各种操作（刷新、插入、删除、动画）/">荼菜的iOS笔记--UITableViewCell的各种操作（刷新、插入、删除、动画）</a>
    </h1>
  

        
        <a href="/2016/04/02/荼菜的iOS笔记-UITableViewCell的各种操作（刷新、插入、删除、动画）/" class="archive-article-date">
  	<time datetime="2016-04-02T03:56:06.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-04-02</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-b92eef750dae48a9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><strong>前言：最近在做一个聊天的对话机器人应用，主界面就是一个tableView，所以难免用到了对cell的各种操作。下边代码全部为从工程中拷贝出来的，以备自己下次使用，由于是公司的工程，故不能贴出Demo，但如有有疑问还可以问我，必定有问必答。</strong></p>
<p>##<strong>一、刷新数据源</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//刷新整个Section</div><div class="line">- (void)reloadDataBySection</div><div class="line">&#123;</div><div class="line">NSIndexSet* indexSet = [NSIndexSet indexSetWithIndex:0];</div><div class="line">[self.tableView reloadSections:indexSet withRowAnimation:UITableViewRowAnimationTop];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//通过刷新某个Section的每一个Row来刷新Section </div><div class="line">- (void)reloadDataBySection</div><div class="line">&#123;</div><div class="line">NSIndexSet* indexSet = [NSIndexSet indexSetWithIndex:0];</div><div class="line">[self.tableView reloadSections:indexSet withRowAnimation:UITableViewRowAnimationTop];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//刷新单行</div><div class="line">- (void)reloadSingleRow</div><div class="line">&#123;</div><div class="line">[self.tableView reloadRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##<strong>二、插入数据源</strong><br>在调用insertRowsAtIndexPaths和deleteRowsAtIndexPaths的时候一定要先改变数据源，在调用上述函数，不然会产生crash。<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic,strong) NSMutableArray *indexPathsArray;</div><div class="line">_indexPathsArray = [NSMutableArray array];</div></pre></td></tr></table></figure></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#pragma mark -- 聊天界面数据刷新</div><div class="line"></div><div class="line">//删除最后一行waiting气泡</div><div class="line">-(void)deleteData&#123;</div><div class="line">[_datas removeLastObject];</div><div class="line">[_indexPathsArray addObject:[NSIndexPath indexPathForItem:_datas.count inSection:0]];</div><div class="line">[self.tableView deleteRowsAtIndexPaths:_indexPathsArray withRowAnimation:UITableViewRowAnimationFade];</div><div class="line">[_indexPathsArray removeAllObjects];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//新增一条消息气泡</div><div class="line">-(void)insertData&#123;</div><div class="line">[ws.datas addObject:model];</div><div class="line">[_indexPathsArray addObject:[NSIndexPath indexPathForItem:_datas.count-1 inSection:0]];</div><div class="line">[self.tableView insertRowsAtIndexPaths:_indexPathsArray withRowAnimation:UITableViewRowAnimationLeft];</div><div class="line">[_indexPathsArray removeAllObjects];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//插入一个Section</div><div class="line">-(void)insertData&#123;</div><div class="line">NSInteger datasCount = _datas.count&gt;1?_datas.count-1:0;</div><div class="line">[self.tableView insertSections:[NSIndexSet indexSetWithIndex:datasCount] withRowAnimation:UITableViewRowAnimationTop];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##<strong>三、获取cell所在frame</strong><br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//应用场景：点击Cell后要执行动画，动画需要从当前cell的frame开始变化的场景</div><div class="line">- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath</div><div class="line">&#123;</div><div class="line">CGRect cellFrameInTableView = [tableView rectForRowAtIndexPath:indexPath];</div><div class="line">CGRect cellFrameInSuperview = [tableView convertRect:cellFrameInTableView toView:[tableView superview]];</div><div class="line">DetailViewController* detailViewController = [[DetailViewController alloc] initWithNibName:@&quot;DetailViewController&quot; bundle:nil];</div><div class="line">NSMutableDictionary* dict = [self.arrayForPlaces objectAtIndex:indexPath.row];</div><div class="line">detailViewController.dictForData = dict;</div><div class="line">detailViewController.yOrigin = cellFrameInSuperview.origin.y;</div><div class="line">[self.navigationController pushViewController:detailViewController animated:NO];</div><div class="line">[detailViewController release];</div><div class="line">[tableView deselectRowAtIndexPath:indexPath animated:YES];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//同理，下边为获取**collectionViewCell**相对屏幕和相对collectionView的frame</div><div class="line">CGRect cellFrame = [[collectionView cellForItemAtIndexPath:indexPath] frame];</div><div class="line">CGRect cellFrameInSuperView = [collectionView convertRect:cellFrame toView:collectionView];</div><div class="line">CGRect cellFrameInScreen = [collectionView convertRect:cellFrame toView:self];</div><div class="line">NSLog(@&quot;frameInSuperView --%f &quot;,cellFrameInSuperView.origin.x);</div><div class="line">NSLog(@&quot;cellReal --%f &quot;,cellFrameInScreen.origin.x);</div></pre></td></tr></table></figure>
<p>##<strong>四、cell的一些动画</strong></p>
<ul>
<li><p>cell进入时动画，依次往上拱</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">-(void)startTableViewAnimation&#123;</div><div class="line"></div><div class="line">[self.tableView reloadData];</div><div class="line">NSArray *visibleCells=self.tableView.visibleCells;</div><div class="line">CGFloat tableHeight=self.tableView.bounds.size.height;</div><div class="line"></div><div class="line">for (UITableViewCell *cell in visibleCells) &#123;</div><div class="line">cell.transform = CGAffineTransformMakeTranslation(0, tableHeight);</div><div class="line">&#125;</div><div class="line"></div><div class="line">NSInteger index=0;</div><div class="line">for (UITableViewCell *cell in visibleCells) &#123;</div><div class="line">cell.transform = CGAffineTransformMakeTranslation(0, tableHeight);</div><div class="line">[UIView animateWithDuration:1.0 delay:0.01*index usingSpringWithDamping:0.8 initialSpringVelocity:0     options:UIViewAnimationOptionTransitionNone animations:^&#123;</div><div class="line">cell.transform = CGAffineTransformMakeTranslation(0, 0);</div><div class="line">&#125; completion:nil];</div><div class="line">index += 1;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>cell进入时动画，cell放大</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">-(void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath</div><div class="line">&#123;</div><div class="line">//设置Cell的动画效果为3D效果</div><div class="line">//设置x和y的初始值为0.1；</div><div class="line">cell.layer.transform = CATransform3DMakeScale(0.1, 0.1, 1);</div><div class="line">//x和y的最终值为1</div><div class="line">[UIView animateWithDuration:1 animations:^&#123;</div><div class="line">cell.layer.transform = CATransform3DMakeScale(1, 1, 1);</div><div class="line">&#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>cell出现时，由斜变正</p>
</li>
</ul>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">// 从锚点位置出发，逆时针绕 Y 和 Z 坐标轴旋转90度</div><div class="line">CATransform3D transform3D = CATransform3DMakeRotation(M_PI_2, 0.0, 1.0, 1.0);</div><div class="line">// 定义 cell 的初始状态</div><div class="line">cell.alpha = 0.0;</div><div class="line">cell.layer.transform = transform3D;</div><div class="line">cell.layer.anchorPoint = CGPointMake(0.0, 0.5); // 设置锚点位置；默认为中心点(0.5, 0.5)</div><div class="line">// 定义 cell 的最终状态，执行动画效果</div><div class="line">[UIView animateWithDuration:0.5 animations:^&#123;</div><div class="line">cell.alpha = 1.0;</div><div class="line">cell.layer.transform = CATransform3DIdentity;</div><div class="line">CGRect rect = cell.frame;</div><div class="line">rect.origin.x = 0.0;</div><div class="line">cell.frame = rect;</div><div class="line">&#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>cell删除动画</li>
</ul>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[_tableViews deleteRowsAtIndexPaths:@[cell.indexPath] withRowAnimation:UITableViewRowAnimationLeft];</div><div class="line"></div><div class="line">[UIView animateWithDuration:0.3  animations:^&#123;</div><div class="line">cell.contentView.center = CGPoint(-width / 2, height / 2);</div><div class="line">&#125; completion:^(BOOL finished) &#123;</div><div class="line">[self.tableView deleteRowsAtIndexPaths:xxx  withRowAnimation:UITableViewRowAnimationTop];</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li>cell依次插入动画</li>
</ul>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">@property(nonatomic,strong)NSMutableArray *indesPaths;</div><div class="line">@property (nonatomic,assign)int DatNum;</div><div class="line">@property(nonatomic,strong) NSTimer * timer;</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line"></div><div class="line">[super viewDidLoad];</div><div class="line">[self configInit];</div><div class="line">[self loadData];</div><div class="line">[self startTableViewAnimation];</div><div class="line">self.DatNum = -1;</div><div class="line">NSMutableArray *indexPaths = @[].mutableCopy;</div><div class="line">self.indesPaths = indexPaths;</div><div class="line">self.timer = [NSTimer scheduledTimerWithTimeInterval:0.1 target:self selector:@selector(charusell) userInfo:nil repeats:YES];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)charusell&#123;</div><div class="line"></div><div class="line">self.DatNum = self.DatNum +1;</div><div class="line">if (self.DatNum &lt; self.allDatas.count) &#123;</div><div class="line">[self.indesPaths addObject:[NSIndexPath indexPathForItem:self.DatNum inSection:0]];</div><div class="line">[self.tableView insertRowsAtIndexPaths:self.indesPaths withRowAnimation:UITableViewRowAnimationTop];</div><div class="line">[self.indesPaths removeAllObjects];</div><div class="line">&#125;else&#123;</div><div class="line">[self.timer invalidate];</div><div class="line">//记得当不用这个定时器的时候要销毁.</div><div class="line">self.timer = nil;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section</div><div class="line">&#123;</div><div class="line">// return _allDatas.count;</div><div class="line">return self.DatNum+1;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p><strong>后话：附上之前写的文章，欢迎指正：</strong><br><a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画
</a><br><a href="http://www.jianshu.com/p/88e20ba25eb9" target="_blank" rel="external">荼菜的iOS笔记–UIView的几个Block动画</a><br><a href="http://www.jianshu.com/p/1cff3fe34307" target="_blank" rel="external">荼菜的iOS笔记–一些实用功能。</a><br><a href="http://www.jianshu.com/p/6b850e1e6306" target="_blank" rel="external">荼菜的iOS笔记–一张图记住所有git命令行操作。</a><br><a href="http://www.jianshu.com/p/36346ccc1b92" target="_blank" rel="external">荼菜的iOS笔记–一张图告诉你程序员需要知道的这些网站。</a><br><a href="http://www.jianshu.com/p/77ca88d36682" target="_blank" rel="external">荼菜的iOS笔记–图片裁剪黑魔法。</a><br><a href="http://www.jianshu.com/p/443c60408035" target="_blank" rel="external">荼菜的iOS笔记–iOS自动打包脚本（Python）
</a><br><a href="http://www.jianshu.com/p/36b6443d5ad7" target="_blank" rel="external">荼菜的iOS笔记–我的编码规范参考。</a><br><a href="http://www.jianshu.com/p/3812ede99dca" target="_blank" rel="external">荼菜的iOS笔记–iOS基础优秀博客总结ToDoList</a><br><a href="http://www.jianshu.com/p/191b20c40143" target="_blank" rel="external">荼菜的iOS笔记–Xcode Tips</a><br><strong>当然，我还写过诗。。。</strong><br><a href="http://www.jianshu.com/p/f6927319f802" target="_blank" rel="external">光。</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/04/02/荼菜的iOS笔记-UITableViewCell的各种操作（刷新、插入、删除、动画）/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-荼菜的iOS笔记-iOS基础优秀博客总结ToDoList" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/28/荼菜的iOS笔记-iOS基础优秀博客总结ToDoList/">荼菜的iOS笔记--iOS基础优秀博客总结ToDoList</a>
    </h1>
  

        
        <a href="/2016/03/28/荼菜的iOS笔记-iOS基础优秀博客总结ToDoList/" class="archive-article-date">
  	<time datetime="2016-03-28T11:41:46.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-03-28</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-8d200f75547e55a3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ToDoList"></p>
<p><strong>前言：最近在总结iOS比较底层的东西，于是翻遍了各个大牛的博客，看到<a href="http://www.jianshu.com/u/263107bb1199" target="_blank" rel="external">AidenRao</a>总结的文章，挨个点进去看了很不错，于是又补充了些我觉得不错的文章，给自己做个备份。</strong></p>
<hr>
<p>#类和对象</p>
<p><a href="http://blog.sunnyxx.com/2014/08/30/objc-pre-main/" target="_blank" rel="external">iOS程序main函数之前发生了什么</a><br><a href="http://blog.devtang.com/2013/01/13/two-stage-creation-on-cocoa/" target="_blank" rel="external"><a href="http://blog.devtang.com/2013/01/13/two-stage-creation-on-cocoa/" target="_blank" rel="external">谈ObjC对象的两段构造模式</a></a><br><a href="https://github.com/Draveness/iOS-Source-Code-Analyze/blob/master/contents/objc/%E4%BB%8E%20NSObject%20%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BA%86%E8%A7%A3%20isa.md" target="_blank" rel="external">从NSObject的初始化了解isa (1)</a><br><a href="https://github.com/Draveness/iOS-Source-Code-Analyze/blob/master/contents/objc/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20ObjC%20%E4%B8%AD%E6%96%B9%E6%B3%95%E7%9A%84%E7%BB%93%E6%9E%84.md" target="_blank" rel="external">深入解析ObjC中方法的结构(2)</a><br><a href="http://www.cocoawithlove.com/2010/01/what-is-meta-class-in-objective-c.html" target="_blank" rel="external">What is a meta-class in Objective-C?</a><br><a href="https://github.com/Draveness/iOS-Source-Code-Analyze/blob/master/contents/objc/%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%A6%82%E4%BD%95%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%EF%BC%88iOS%EF%BC%89.md" target="_blank" rel="external">对象是如何初始化的</a><br><a href="http://tech.meituan.com/DiveIntoCategory.html" target="_blank" rel="external">深入理解Objective-C：Category</a></p>
<hr>
<p>#RunLoop  ：<br><a href="http://blog.ibireme.com/2015/05/18/runloop/" target="_blank" rel="external">YY大神(深入理解RunLoop)</a><br><a href="http://v.youku.com/v_show/id_XODgxODkzODI0.html" target="_blank" rel="external">视频：孙源(百度)(线下分享RunLoop)</a><br><a href="http://www.jianshu.com/p/63f79fa04e52" target="_blank" rel="external">RunLoop总结：RunLoop基础知识</a><br><a href="http://www.jianshu.com/p/902741bcf707" target="_blank" rel="external">RunLoop 总结：RunLoop的应用场景（一）保证线程长久存活</a><br><a href="http://www.jianshu.com/p/b2d431d6fa09" target="_blank" rel="external">RunLoop 总结：RunLoop的应用场景（二）让Timer正常运转</a><br><a href="http://www.jianshu.com/p/aa499d790c50" target="_blank" rel="external">RunLoop总结：RunLoop的应用场景（三）滚动视图流畅性优化</a><br><a href="http://www.jianshu.com/p/9e2529fbe963" target="_blank" rel="external">RunLoop总结：RunLoop的应用场景（四）App卡顿监测</a><br><a href="http://www.jianshu.com/p/fee0c5155b8e" target="_blank" rel="external">RunLoop总结：RunLoop的应用场景（五）阻止App崩溃一次</a></p>
<hr>
<p>#Runtime<br><a href="http://aes.jypc.org/?p=18581" target="_blank" rel="external">iOS-runtime</a><br><a href="http://www.jianshu.com/p/927c8384855a" target="_blank" rel="external">iOS-runtime理解</a><br><a href="http://www.uu3aa.com/a/29855" target="_blank" rel="external"><a href="http://www.uu3aa.com/a/29855" target="_blank" rel="external">iOS开发之Runtime常用示例总结</a></a><br><a href="http://tech.meituan.com/DiveIntoMethodCache.html" target="_blank" rel="external">深入理解Objective-C：方法缓存</a><br><a href="http://blog.cocoabit.com/yi-li-jie-objctive-c-runtime/" target="_blank" rel="external">译:理解 Objective-C Runtime</a><br><a href="https://www.ianisme.com/ios/2019.html" target="_blank" rel="external"><a href="https://www.ianisme.com/ios/2019.html" target="_blank" rel="external">Objective-C Runtime 1小时入门教程</a></a><br><a href="http://tech.glowing.com/cn/method-swizzling-aop/" target="_blank" rel="external">Method Swizzling 和 AOP 实践</a><br><a href="http://www.jianshu.com/p/9b36e1b636d8" target="_blank" rel="external">刨根问底：对于 self = [super init] 的思考</a></p>
<p><code>在objc中的一个重要的特点就是对象化。我们所用的 NSObject 这个类其实也是一个对象。如果我们初始化 NSObject *p = [[NSObject alloc] init]; ，那么 p 这个对象中在runtime时会当作一个结构体isa_t对象来处理。而其中的 isa 指针（由objc_object继承而来）会指向自身的类对象。也就是说，这里的 p.isa 是指向 NSObject （这种写法不太严格，但是可以这么描述）。同此，文中的 block 也为了模仿 对象 的结构，制作了一个isa属性。对于isa的具体细节我没有写过相关文章，但是强烈推荐学习这篇博文</code></p>
<p><strong><em>runtime可以做什么？</em></strong></p>
<ul>
<li>多继承</li>
<li>交换两个方法法的实现</li>
<li>关联对象</li>
</ul>
<hr>
<p>#GCD<br><a href="https://github.com/nixzhu/dev-blog/blob/master/2014-04-19-grand-central-dispatch-in-depth-part-1.md" target="_blank" rel="external">GCD 深入理解：第一部分</a><br><a href="https://github.com/nixzhu/dev-blog/blob/master/2014-05-14-grand-central-dispatch-in-depth-part-2.md" target="_blank" rel="external">GCD 深入理解：第二部分</a></p>
<hr>
<p>#多线程 与 锁<br><a href="http://www.tanhao.me/pieces/616.html/" target="_blank" rel="external">Objective-C中不同方式实现锁(一)</a><br><a href="http://www.tanhao.me/pieces/643.html/" target="_blank" rel="external">Objective-C中不同方式实现锁(二)</a><br><a href="http://blog.duicode.com/1286.html" target="_blank" rel="external">iOS中的锁</a><br><a href="http://www.cnblogs.com/GarveyCalvin/p/4212611.html" target="_blank" rel="external"><a href="http://www.cnblogs.com/GarveyCalvin/p/4212611.html" target="_blank" rel="external">iOS开发－多线程开发之线程安全篇</a></a><br><a href="http://www.jianshu.com/p/35dd92bcfe8c" target="_blank" rel="external">iOS多线程-各种线程锁的简单介绍</a><br><a href="http://yulingtianxia.com/blog/2015/11/01/More-than-you-want-to-know-about-synchronized/" target="_blank" rel="external"><a href="http://yulingtianxia.com/blog/2015/11/01/More-than-you-want-to-know-about-synchronized/" target="_blank" rel="external">关于 @synchronized，这儿比你想知道的还要多</a></a><br><a href="http://www.jianshu.com/p/938d68ed832c" target="_blank" rel="external">iOS中保证线程安全的几种方式与性能对比</a></p>
<hr>
<p>#并发编程<br><a href="https://hit-alibaba.github.io/interview/iOS/Cocoa-Touch/Multithreading.html" target="_blank" rel="external">Cocoa 并发编程</a><br><a href="https://bestswifter.com/multithreadconclusion/" target="_blank" rel="external"><a href="https://bestswifter.com/multithreadconclusion/" target="_blank" rel="external">iOS 多线程编程 —— GCD 与 NSOperation 总结</a></a></p>
<hr>
<p>#MRC 和 ARC<br><a href="https://hit-alibaba.github.io/interview/iOS/ObjC-Basic/MM.html" target="_blank" rel="external">Objective-C 中的内存分配</a></p>
<hr>
<p>#事件处理<br><a href="http://www.cnblogs.com/snake-hand/p/3178070.html" target="_blank" rel="external"><a href="http://www.cnblogs.com/snake-hand/p/3178070.html" target="_blank" rel="external">Cocoa Touch事件处理流程–响应者链</a></a><br><a href="http://www.cnblogs.com/forwk/p/4843159.html" target="_blank" rel="external"><a href="http://www.cnblogs.com/forwk/p/4843159.html" target="_blank" rel="external">iOS中的事件处理、响应者链条以及第一响应者</a></a><br><a href="http://swift.gg/2016/01/06/utilize-the-responder-chain-for-target-action/" target="_blank" rel="external"><a href="http://swift.gg/2016/01/06/utilize-the-responder-chain-for-target-action/" target="_blank" rel="external">在 Target-Action 中使用响应链</a></a></p>
<hr>
<p>#设计模式<br><a href="https://hit-alibaba.github.io/interview/iOS/Cocoa-Touch/Design.html" target="_blank" rel="external">设计模式</a></p>
<hr>
<p>#动画<br><a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画</a></p>
<hr>
<p>#流畅：</p>
<p><a href="http://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/" target="_blank" rel="external">离屏渲染</a><br><a href="https://objccn.io/issue-3-1/" target="_blank" rel="external"><a href="https://objccn.io/issue-3-1/" target="_blank" rel="external">绘制像素到屏幕上</a></a></p>
<hr>
<p>#Swift<br><a href="http://www.swift51.com/swift3.0/chapter1/02_a_swift_tour.html" target="_blank" rel="external">Swift教程</a></p>
<hr>
<p>#反编译(逆向)：工具 FLEXLoader</p>
<hr>
<p>#python：<br>   step 1： 两本书：<a href="https://bop.molun.net/15.io.html" target="_blank" rel="external">《A Byte of Python》</a>  《Learning Python》《Python核心编程  宋吉广 译》<br>   step 2： 视频：<a href="http://www.imooc.com/learn/177" target="_blank" rel="external">Python 入门（imooc)</a><br>   step 3： 博客：<a href="http://www.jianshu.com/u/a528c4dd31d3" target="_blank" rel="external">菜鸟学python)</a>  </p>
<hr>
<p>#Unity3D<br><a href="http://www.51zxw.net/list.aspx?cid=454" target="_blank" rel="external">体验第一个游戏雏形</a></p>
<p>#AFNetWorking</p>
<hr>
<p>#ResumeSample<br><a href="https://github.com/geekcompany/ResumeSample" target="_blank" rel="external">ResumeSample</a><br><a href="https://github.com/ChenYilong/iOSInterviewQuestions" target="_blank" rel="external">《招聘一个靠谱的 iOS》— 参考答案</a></p>
<hr>
<p>#<strong>源码解析</strong><br><a href="https://github.com/Draveness/iOS-Source-Code-Analyze" target="_blank" rel="external">源码解析-Draveness</a></p>
<hr>
<p>#阿里巴巴<br><a href="https://hit-alibaba.github.io/interview/iOS/ObjC-Basic/Class.html" target="_blank" rel="external">hit-alibaba.github.io</a></p>
<hr>
<p>#拓展<br><a href="http://www.jianshu.com/p/3fce0bd6f045" target="_blank" rel="external">iOS 中armv7,armv7s,arm64,i386,x86_64 都是什么</a><br><a href="http://blog.csdn.net/lizhongfu2013/article/details/42387311" target="_blank" rel="external"><a href="http://blog.csdn.net/lizhongfu2013/article/details/42387311" target="_blank" rel="external">iOS开发～制作同时支持armv7,armv7s,arm64,i386,x86_64的静态库.a</a></a><br><strong>clang -rewrite-objc MyClass.m  执行上面的命令，将这一句重写为C代码</strong> </p>
<hr>
<p><strong>后话：附上之前写的文章，欢迎指正：</strong><br><a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画
</a><br><a href="http://www.jianshu.com/p/88e20ba25eb9" target="_blank" rel="external">荼菜的iOS笔记–UIView的几个Block动画</a><br><a href="http://www.jianshu.com/p/1cff3fe34307" target="_blank" rel="external">荼菜的iOS笔记–一些实用功能。</a><br><a href="http://www.jianshu.com/p/fa53a2ffc0c6" target="_blank" rel="external">荼菜的iOS笔记–UITableViewCell的各种操作（刷新、插入、删除、动画）</a><br><a href="http://www.jianshu.com/p/6b850e1e6306" target="_blank" rel="external">荼菜的iOS笔记–一张图记住所有git命令行操作。</a><br><a href="http://www.jianshu.com/p/36346ccc1b92" target="_blank" rel="external">荼菜的iOS笔记–一张图告诉你程序员需要知道的这些网站。</a><br><a href="http://www.jianshu.com/p/77ca88d36682" target="_blank" rel="external">荼菜的iOS笔记–图片裁剪黑魔法。</a><br><a href="http://www.jianshu.com/p/443c60408035" target="_blank" rel="external">荼菜的iOS笔记–iOS自动打包脚本（Python）
</a><br><a href="http://www.jianshu.com/p/36b6443d5ad7" target="_blank" rel="external">荼菜的iOS笔记–我的编码规范参考。</a><br><a href="http://www.jianshu.com/p/191b20c40143" target="_blank" rel="external">荼菜的iOS笔记–Xcode Tips</a><br><strong>当然，我还写过诗。。。</strong><br><a href="http://www.jianshu.com/p/f6927319f802" target="_blank" rel="external">光。</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/03/28/荼菜的iOS笔记-iOS基础优秀博客总结ToDoList/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-荼菜的iOS笔记-Core-Animation-核心动画" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/02/荼菜的iOS笔记-Core-Animation-核心动画/">荼菜的iOS笔记--Core Animation 核心动画</a>
    </h1>
  

        
        <a href="/2016/03/02/荼菜的iOS笔记-Core-Animation-核心动画/" class="archive-article-date">
  	<time datetime="2016-03-02T08:55:36.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-03-02</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-d76eca0a75401c1c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="TuCai"></p>
<p><strong>前言：前些天学习核心动画时参考了一些别人的经验贴，之前是保存在自己的为知笔记里里的，只记录了一些适合自己的片段，因此有些出处来自于前人大神，但当时链接当时并未记录，望谅解。</strong></p>
<p>#概念#</p>
<ul>
<li>Core Animation可以用在 Mac OS X 和 iOS平台. Core Animation的动画执行过程是在后台操作的.不会阻塞主线程. 要注意的是, Core Animation是直接作用在CALayer上的.并非UIView。</li>
<li>使用步骤：<br>1、创建一个CAAnimation对象<br>2、设置一些动画的相关属性<br>3、给CALayer添加动画（addAnimation:forKey: 方法）<br>4、停止CALayer动画（removeAnimationForKey: 方法）<br>注意：<strong>1. 当你将animation加入layer层以后，你就无法再更改动画效果了。2.注意: 如果当动画正在执行的时候, 将程序退出到后台, 那么当程序再次进入前台的时候就不执行了。原因: 因为再次进入前台后动画已经被删除了。解决: anim.removedOnCompletion = NO;</strong></li>
</ul>
<h1 id="一-、CAAnimation"><a href="#一-、CAAnimation" class="headerlink" title="一 、CAAnimation"></a>一 、CAAnimation</h1><p>CAAnimation类是所有动画对象的父类，负责控制动画的持续时间和速度等，是个抽象类，不能直接使用，应该使用它具体的子类,CAAnimation的继承结构如下图：<br><img src="http://upload-images.jianshu.io/upload_images/1385290-8bace45f764e3e90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="CAAnimation继承结构"></p>
<p>##属性：</p>
<ul>
<li><strong> duration</strong>：动画的持续时间，默认为0.25秒</li>
<li><strong>repeatCount</strong>：动画的重复次数</li>
<li><strong>repeatDuration</strong>：动画的重复时间</li>
<li><strong>removedOnCompletion</strong>：默认为YES，代表动画执行完毕后就从图层上移除，图形会恢复到动画执行前的状态。如果想让图层保持显示动画执行后的状态，那就设置为NO，不过还要设置fillMode属性为kCAFillModeForwards</li>
<li><strong>fillMode</strong>：决定当前对象在非active时间段的行为.比如动画开始之前,动画结束之后</li>
<li><strong>beginTime</strong>：可以用来设置动画延迟执行时间，若想延迟2s，就设置为CACurrentMediaTime()+2，CACurrentMediaTime()为图层的当前时间</li>
<li><p><strong>timingFunction</strong>：速度控制函数，控制动画运行的节奏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">枚举参数：</div><div class="line">（1）kCAMediaTimingFunctionLinear 时间曲线函数，匀速</div><div class="line">（2）kCAMediaTimingFunctionEaseIn 时间曲线函数，由慢到特别快</div><div class="line">（3）kCAMediaTimingFunctionEaseOut 时间曲线函数，由快到慢</div><div class="line">（4）kCAMediaTimingFunctionEaseInEaseOut 时间曲线函数，由慢到快</div><div class="line">（5）kCAMediaTimingFunctionDefault 系统默认</div></pre></td></tr></table></figure>
</li>
<li><p><strong>delegate</strong>：动画代理，一般设置隐式代理，该代理是NSObject的分类，不需要遵守协议<br>anim.delegate = self;<br>（1）- (void)animationDidStart:(CAAnimation <em>)anim;<br>核心动画开始时执行<br>（2）- (void)animationDidStop:(CAAnimation </em>)anim finished:(BOOL)flag;<br>核心动画执行结束后调用</p>
</li>
</ul>
<h1 id="二、-CAPropertyAnimation"><a href="#二、-CAPropertyAnimation" class="headerlink" title="二、 CAPropertyAnimation"></a>二、 CAPropertyAnimation</h1><p>是CAAnimation的子类，也是个抽象类，要想创建动画对象，应该使用它的两个子类：CABasicAnimation和CAKeyframeAnimation</p>
<p>属性：@property(nullable, copy) NSString <em>keyPath;<br>类方法：+ (instancetype)animationWithKeyPath:(nullableNSString </em>)path;</p>
<p><strong>keyPath</strong>参数：<em>通过指定CALayer的一个属性名做为keyPath里的参数(NSString类型)，并且对CALayer的这个属性的值进行修改，达到相应的动画效果。比如，指定@”position”为keyPath，就修改CALayer的position属性的值，以达到平移的动画效果。</em></p>
<p>例子：CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@”position.y”];</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1438251-ad2000af90b2de3e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="keyPath参数"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1438251-b2c222befe265ef3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="keyPath参数"></p>
<h1 id="三、-CABasicAnimation（基本动画）"><a href="#三、-CABasicAnimation（基本动画）" class="headerlink" title="三、 CABasicAnimation（基本动画）"></a>三、 CABasicAnimation（基本动画）</h1><p><strong> 属性：</strong></p>
<ul>
<li><strong>fromValue</strong> : keyPath相应属性的初始值</li>
<li><strong>toValue</strong> : keyPath相应属性的结束值，到某个固定的值（类似transform的make含义）注意：随着动画的进行,在长度为duration的持续时间内,keyPath相应属性的值从fromValue渐渐地变为toValue.如果<strong><em>fillMode = kCAFillModeForwards和removedOnComletion = NO</em></strong>;那么在动画执行完毕后,图层会保持显示动画执行后的状态,但实质上,图层的属性值还是动画执行前的初始值,并没有真正被改变.比如: CALayer的postion初始值为(0,0),CABasicAnimation的fromValue为(10,10),toValue为 (100,100),虽然动画执行完毕后图层保持在(100,100) 这个位置,实质上图层的position还是为(0,0);</li>
<li>byValue：不断进行累加的数值（类似transform非make方法的含义）<br>CABasicAnimation <em>animation = [CABasicAnimation animationWithKeyPath:@”transform.rotation.z”];<br>animation.byValue = @(M_PI </em> 2);</li>
</ul>
<h1 id="四、-CAKeyframeAnimation（关键帧动画）"><a href="#四、-CAKeyframeAnimation（关键帧动画）" class="headerlink" title="四、 CAKeyframeAnimation（关键帧动画）"></a>四、 CAKeyframeAnimation（关键帧动画）</h1><p>和CABasicAnimation的区别：CABasicAnimation只能从一个数值(fromValue)变到另一个数值(toValue)，而CAKeyframeAnimation会使用一个NSArray（values）保存这些数值，实现多个点间的动画效果，CABasicAnimation可看做是最多只有2个关键帧的CAKeyframeAnimation</p>
<p><strong>属性：</strong></p>
<ul>
<li><p>1.<strong>values</strong>:NSArray对象，里面的元素称为”关键帧”（NSValue类型），动画对象会在指定的时间(duration)内，依次显示values数组中的每一个关键帧（ NSValue）<br>//设置动画属性NSValue <em>p1 = [NSValue valueWithCGPoint:CGPointMake(50, 150)];NSValue </em>p2 = [NSValue valueWithCGPoint:CGPointMake(250, 150)];NSValue <em>p3 = [NSValue valueWithCGPoint:CGPointMake(50, 550)];NSValue </em>p4 = [NSValue valueWithCGPoint:CGPointMake(250, 550)];<br>animKey.values = @[p1, p2, p3, p4];</p>
</li>
<li><p>2.<strong>path</strong>:可以设置一个CGPathRef\CGMutablePathRef,让层跟着路径移动，path只对CALayer的<strong><em>anchorPoint(锚点)</em></strong>和position起作用，<em>如果设置了path，那么values将被忽略</em>。<br>UIBezierPath *path = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(50, 100, 250, 100)];<br>animKey.path = path.CGPath;</p>
</li>
<li><p>3.<strong>keyTimes</strong>：（keyTimes属性指定的是当前状态节点到初始状态节点的时间占动画总时长的比例<br>。若果不设置keyTimes则匀速播放）可以为对应的关键帧指定对应的时间点,其取值范围为0到1.0,keyTimes中的每一个时间值都对应values中的每一帧，当keyTimes没有设置的时候,各个关键帧的时间是平分的</p>
</li>
<li><p>4.<strong>rotationMode</strong>：旋转模式<br>（1）如果为nil或不设置效果为</p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1385290-bebe0c66448abd71.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="旋转模式效果1"></p>
<p>（2）设置为kCAAnimationRotateAuto 或 kCAAnimationRotateAutoReverse 会随着旋转的角度做 ”自转“</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1385290-48a16fa02eb81dc7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="旋转模式效果2"></p>
<h1 id="五、-CAAnimationGroup（组动画）"><a href="#五、-CAAnimationGroup（组动画）" class="headerlink" title="五、 CAAnimationGroup（组动画）"></a>五、 CAAnimationGroup（组动画）</h1><p>可以保存一组动画对象，将CAAnimationGroup对象加入层后，组中所有动画对象可以同时并发运行<br><strong>属性：</strong><br><strong>animations</strong>：动画组，用来保存一组动画对象的NSArray，默认情况下，一组动画对象是同时运行的，也可以通过设置动画对象的beginTime属性来更改动画的开始时间。</p>
<p>栗子🌰🔽</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1438251-d1f18997e631b2af.gif?imageMogr2/auto-orient/strip" alt="CAAnimationGroup.gif"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad]; </div><div class="line">    self.button.frame = CGRectMake(150, 100, 50, 50);</div><div class="line">&#125;</div><div class="line">-(UIButton *)button&#123;</div><div class="line">    if (_button == nil) &#123;</div><div class="line">        UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];</div><div class="line">        button.backgroundColor=[UIColor redColor];</div><div class="line">        button.tag=0;</div><div class="line">        [button addTarget:self action:@selector(buttonClicked:) forControlEvents:UIControlEventTouchUpInside];</div><div class="line">        [self.view addSubview:button];</div><div class="line">        _button=button;</div><div class="line">    &#125;</div><div class="line">    return _button;</div><div class="line">&#125;</div><div class="line">//点击事件</div><div class="line">-(void)buttonClicked:(UIButton *)button&#123;</div><div class="line">    CAKeyframeAnimation * animation = [CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</div><div class="line">    animation.values = @[[NSValue valueWithCGPoint:CGPointMake(0, 0)],[NSValue valueWithCGPoint:CGPointMake(100, 100)],[NSValue valueWithCGPoint:CGPointMake(0, 200)]];</div><div class="line">    animation.duration = 2;</div><div class="line">    animation.removedOnCompletion = NO;</div><div class="line">    animation.fillMode = kCAFillModeForwards;</div><div class="line">    animation.keyTimes = @[@0,@0.25,@0.5,@0.75,@1];</div><div class="line">    animation.path = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(100, 100, 100, 100)].CGPath;</div><div class="line">    CABasicAnimation * animation2 = [CABasicAnimation animationWithKeyPath:@&quot;cornerRadius&quot;];</div><div class="line">    animation2.toValue = @50;</div><div class="line">    animation2.duration = 2;</div><div class="line">    animation2.fillMode = kCAFillModeForwards;</div><div class="line">    animation2.removedOnCompletion = NO;</div><div class="line">    </div><div class="line">    CAAnimationGroup * group = [CAAnimationGroup animation];</div><div class="line">    group.duration = 2;</div><div class="line">    group.fillMode = kCAFillModeForwards;</div><div class="line">    group.removedOnCompletion = NO;</div><div class="line">    group.animations = @[animation,animation2];</div><div class="line">    [button.layer addAnimation:group forKey:@&quot;group&quot;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="六、-CATransition（转场动画）"><a href="#六、-CATransition（转场动画）" class="headerlink" title="六、 CATransition（转场动画）"></a>六、 CATransition（转场动画）</h1><p>用于做转场动画，能够为层提供移出屏幕和移入屏幕的动画效果。iOS比Mac OS X的转场动画效果少一点。UINavigationController就是通过CATransition实现了将控制器的视图推入屏幕的动画效果<br><strong>属性：</strong></p>
<ul>
<li>1.<strong><em>type</em></strong>：设置动画过渡的类型</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1438251-5d74b2646f42b33f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="转场动画过渡效果"></p>
<ul>
<li>2.<strong><em>subtype</em></strong>：设置动画过渡方向<br>枚举:kCATransitionFromRight<br>kCATransitionFromLeft<br>kCATransitionFromTop<br>kCATransitionFromBottom</li>
<li>3.<strong><em>startProgress</em></strong>：动画起点(在整体动画的百分比)</li>
<li>4.<strong><em>endProgress</em></strong>：动画终点(在整体动画的百分比)</li>
</ul>
<p><strong>场景：所以我目前测出来的能用的情况有，imageView切换图片，控制器的push或modal，UIView对象调用exchangeSubviewAtIndex：WithIndex：方法的时候可以出发转场动画，其他我真是没有测出来，有大神知道还望告知=。=十分感谢。</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1438251-8f4d7db34f0fee8f.gif?imageMogr2/auto-orient/strip" alt="CATransition.gif"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">-(void)buttonClicked:(UIButton *)button&#123;</div><div class="line">    </div><div class="line">    CATransition *animation = [CATransition animation];</div><div class="line">    animation.duration = 5;</div><div class="line">    animation.fillMode = kCAFillModeForwards;</div><div class="line">    animation.type = @&quot;rippleEffect&quot;;</div><div class="line">    animation.subtype = kCATransitionFromTop;</div><div class="line">    [self.img.layer addAnimation:animation forKey:@&quot;ripple&quot;];</div><div class="line">    self.img.image = [UIImage imageNamed:@&quot;ic_empty_theater&quot;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p><strong>后话：附上之前写的文章，欢迎指正：</strong><br><a href="http://www.jianshu.com/p/88e20ba25eb9" target="_blank" rel="external">荼菜的iOS笔记–UIView的几个Block动画</a><br><a href="http://www.jianshu.com/p/1cff3fe34307" target="_blank" rel="external">荼菜的iOS笔记–一些实用功能。</a><br><a href="http://www.jianshu.com/p/fa53a2ffc0c6" target="_blank" rel="external">荼菜的iOS笔记–UITableViewCell的各种操作（刷新、插入、删除、动画）</a><br><a href="http://www.jianshu.com/p/6b850e1e6306" target="_blank" rel="external">荼菜的iOS笔记–一张图记住所有git命令行操作。</a><br><a href="http://www.jianshu.com/p/36346ccc1b92" target="_blank" rel="external">荼菜的iOS笔记–一张图告诉你程序员需要知道的这些网站。</a><br><a href="http://www.jianshu.com/p/77ca88d36682" target="_blank" rel="external">荼菜的iOS笔记–图片裁剪黑魔法。</a><br><a href="http://www.jianshu.com/p/443c60408035" target="_blank" rel="external">荼菜的iOS笔记–iOS自动打包脚本（Python）
</a><br><a href="http://www.jianshu.com/p/36b6443d5ad7" target="_blank" rel="external">荼菜的iOS笔记–我的编码规范参考。</a><br><a href="http://www.jianshu.com/p/3812ede99dca" target="_blank" rel="external">荼菜的iOS笔记–iOS基础优秀博客总结ToDoList</a><br><a href="http://www.jianshu.com/p/191b20c40143" target="_blank" rel="external">荼菜的iOS笔记–Xcode Tips</a><br><strong>当然，我还写过诗。。。</strong><br><a href="http://www.jianshu.com/p/f6927319f802" target="_blank" rel="external">光。</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/03/02/荼菜的iOS笔记-Core-Animation-核心动画/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-荼菜的iOS笔记-一些实用功能。" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/25/荼菜的iOS笔记-一些实用功能。/">荼菜的iOS笔记--一些实用功能。</a>
    </h1>
  

        
        <a href="/2015/12/25/荼菜的iOS笔记-一些实用功能。/" class="archive-article-date">
  	<time datetime="2015-12-25T08:52:56.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-12-25</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-4b4e153f14c5ba7f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="好冷，该穿秋裤了"></p>
<p><strong>前言：开发过程中遇到许多不太熟练的知识点，这些都是借鉴别人又被我应用的一些东西，之前是遇到一点就记录到笔记里，时间久了知识点就有点散，正好整理到一起，欢迎收藏，以后还会陆续增加知识点。</strong></p>
<p><strong>1.不常用的属性</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//取消自动布局</div><div class="line">self.automaticallyAdjustsScrollViewInsets = NO;</div><div class="line">//解决tabbar挡住最后一行问题</div><div class="line">self.edgesForExtendedLayout = UIRectEdgeNone;</div><div class="line">//隐藏cell线 </div><div class="line">self.tableView.separatorStyle = UITableViewCellSeparateStyleNone;</div><div class="line">//push到下个页面需要隐藏tabBar时</div><div class="line">svc.hidesBottomBarWhenPushed=YES;</div><div class="line">//多余cell空白</div><div class="line">self.tableView.tableFooterView = [[UIView alloc]init];</div><div class="line">//不超过屏幕也能滑</div><div class="line">self.ShowCollection.alwaysBounceVertical = YES;</div><div class="line">//选中cell 无背景色</div><div class="line">cell.selectionStyle = UITableViewCellSelectionStyleNone;</div><div class="line">//推时隐藏tabbar</div><div class="line">self.hidesBottomBarWhenPushed = YES;</div><div class="line">//button文字靠右</div><div class="line">[_button setContentHorizontalAlignment:UIControlContentHorizontalAlignmentRight];</div><div class="line">//button文字靠左</div><div class="line">[_button setContentHorizontalAlignment:UIControlContentHorizontalAlignmentLeft];</div></pre></td></tr></table></figure></p>
<p><strong>2.解决时差问题</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">    //解决时差问题</div><div class="line">    NSDate * date = sender.date;</div><div class="line">    NSTimeZone *zone = [NSTimeZone systemTimeZone];</div><div class="line">    NSInteger interval = [zone secondsFromGMTForDate: date];</div><div class="line">    NSDate *localeDate = [date  dateByAddingTimeInterval: interval];</div><div class="line"></div><div class="line"> //时差转化</div><div class="line">    NSDate *datenow = [NSDate date];//输出结果:2014-12-12 02:23:25 +0000晚八个小时</div><div class="line">    NSTimeZone *zone = [NSTimeZone systemTimeZone];</div><div class="line">    NSInteger interval = [zone secondsFromGMTForDate:datenow];</div><div class="line">    NSDate *localeDate = [datenow  dateByAddingTimeInterval: interval];//2014-12-12 10:23:25 +0000</div><div class="line">    NSLog(@&quot;%@&quot;, localeDate);</div><div class="line">    </div><div class="line">    //将秒数转化为日期格式</div><div class="line">    NSDate *confromTimesp = [NSDatedateWithTimeIntervalSince1970:1363948516];</div><div class="line">    NSLog(@&quot;1363948516  = %@&quot;,confromTimesp);//2013-03-22 10:35:16 +0000</div><div class="line"></div><div class="line">//将秒数转化为特定格式的日期格式</div><div class="line">NSString *str=@&quot;1368082020&quot;;//时间戳</div><div class="line">    NSTimeInterval time=[str doubleValue]+28800;//因为时差问题要加8小时 == 28800 sec</div><div class="line">    NSDate *detaildate=[NSDate dateWithTimeIntervalSince1970:time];</div><div class="line">    NSLog(@&quot;date:%@&quot;,[detaildate description]);</div><div class="line">    //实例化一个NSDateFormatter对象</div><div class="line">    NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];</div><div class="line">    //设定时间格式,这里可以设置成自己需要的格式</div><div class="line">    [dateFormatter setDateFormat:@&quot;yyyy-MM-dd&quot;];</div><div class="line">    NSString *currentDateStr = [dateFormatter stringFromDate: detaildate];</div><div class="line"></div><div class="line">//最终版本</div><div class="line">    NSString * startStr = [NSStringstringWithFormat:@&quot;%@&quot;,dic[@&quot;startdate&quot;]];</div><div class="line">    NSTimeInterval startTime = [startStr doubleValue] / 1000 + 28800;</div><div class="line">    NSDate * startLocalDate = [NSDatedateWithTimeIntervalSince1970:startTime];</div><div class="line">    NSDateFormatter * startFormatter = [[NSDateFormatter alloc]init];</div><div class="line">    [startFormatter setDateFormat:@&quot;yyyy.MM.dd&quot;];</div><div class="line">    NSString * startDate = [startFormatter stringFromDate:startLocalDate];</div></pre></td></tr></table></figure></p>
<p><strong>3.页面切换水波纹动画</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">DetailViewController * dvc = [[DetailViewControlleralloc]initWithSid:self.dataArray[indexPath.row] [@&quot;secid&quot;]WithCollectorsCount:[self.dataArray[indexPath.row][@&quot;collectcnt&quot;]intValue]];</div><div class="line">    dvc.hidesBottomBarWhenPushed = YES;</div><div class="line">    CATransition*transition=[CATransition animation];</div><div class="line">    transition.duration=1.0f;</div><div class="line">    transition.type=@&quot;rippleEffect&quot;;</div><div class="line">    transition.subtype=@&quot;fromTop&quot;;</div><div class="line">    [self.navigationController.view.layer addAnimation:transitionforKey:nil];</div><div class="line">    [self.navigationController pushViewController:dvc animated:YES];</div></pre></td></tr></table></figure></p>
<p><strong>4.去掉导航条和tabBar的边框</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)viewWillAppear:(BOOL)animated &#123;</div><div class="line">    [self.navigationController.navigationBar setBackgroundImage:[TDUtils createImageWithColor:[UIColor clearColor]] forBarMetrics:UIBarMetricsDefault];</div><div class="line">    [self.navigationController.navigationBar setBackIndicatorTransitionMaskImage:[TDUtils createImageWithColor:[UIColor clearColor]]];</div><div class="line">    [self.navigationController.navigationBar setShadowImage:[TDUtils createImageWithColor:[UIColor clearColor]]];</div><div class="line">    [self.tabBarController.tabBar setBackgroundImage:[TDUtils createImageWithColor:[UIColor clearColor]]];</div><div class="line">    [self.tabBarController.tabBar setShadowImage:[TDUtils createImageWithColor:[UIColor clearColor]]];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>5.导航条多按钮</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSArray *buttonArray = [[NSArray alloc]initWithObjects:cleanButton,saveButton, nil];</div><div class="line">self.navigationItem.rightBarButtonItems = buttonArray;</div></pre></td></tr></table></figure></p>
<p><strong>6.真机测试时出现的问题</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">No architectures to compile for (ONLY_ACTIVE_ARCH=YES, active arch=armv7, VA</div><div class="line">运行报错</div><div class="line">出现的原因：armv7s是应用在iPhone 5 A6 的架构上的</div><div class="line">解决的方式：</div><div class="line">1，在Project target里“Architectures”设置为“Standard （armv7,armv7s）”</div><div class="line">2，修改在Project target里“Build Settings”的“Valid Architectures”添加“i386”和“armv7”(Xcode4.6 以上版本不再支持armv6，请去掉)</div><div class="line">3,设置”Build Active Architecture Only”为“NO”。这样你build你的项目的时候就能在iphoe5和iphoe4s里执行。</div></pre></td></tr></table></figure></p>
<p><strong>7.datepicker修改为中文</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">方法一</div><div class="line">[datePicker setLocale:[[NSLocale alloc]initWithLocaleIdentifier:@&quot;zh_CN&quot;]];</div><div class="line">方法二</div><div class="line">NSLocale *locale = [[NSLocale alloc] initWithLocaleIdentifier:@&quot;zh_CN&quot;];//设置为中文显示3</div><div class="line">    _datePicker.locale = locale;</div></pre></td></tr></table></figure></p>
<p><strong>8.设置属性字体</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">NSMutableParagraphStyle *ps = [[NSMutableParagraphStyle alloc] init];</div><div class="line">[ps setLineHeightMultiple:lineHeight];//行高 [ps setLineSpacing:lineHeight];//行间距</div><div class="line">ps.lineBreakMode = NSLineBreakByTruncatingTail;//末尾省略号</div><div class="line">ps.lineHeightMultiple = TextLineHeight; //行间距</div><div class="line">NSMutableDictionary *attributesDic= [NSMutableDictionary dictionary];</div><div class="line">attributesDic[NSForegroundColorAttributeName] = stringColor;</div><div class="line">attributesDic[NSFontAttributeName] = stringFont;</div><div class="line">attributesDic[NSKernAttributeName] = @(0.5);//字间距</div><div class="line">attributesDic[NSParagraphStyleAttributeName] = ps;</div><div class="line">NSMutableAttributedString *attributedText = [[NSMutableAttributedString alloc] initWithString:string attributes:attributesDic];</div></pre></td></tr></table></figure></p>
<p><strong>9.屏幕不允许旋转的方法是什么？</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (NSUInteger)application:(UIApplication *)application supportedInterfaceOrientationsForWindow:(UIWindow *)window</div><div class="line">&#123;</div><div class="line">    return UIInterfaceOrientationMaskPortrait;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>10.电池状态栏改变颜色</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">方法一：不用修改plist</div><div class="line"> [self.navigationController.navigationBar setBarStyle:UIBarStyleBlack];</div><div class="line"></div><div class="line">默认的黑色（UIStatusBarStyleDefault）</div><div class="line">白色（UIStatusBarStyleLightContent）</div><div class="line"></div><div class="line">- (UIStatusBarStyle)preferredStatusBarStyle</div><div class="line">&#123;</div><div class="line">    return UIStatusBarStyleLightContent;</div><div class="line">&#125;</div><div class="line"></div><div class="line">方法二：需要修改plist</div><div class="line">[[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleDefault animated:NO];</div><div class="line"></div><div class="line">/  设置状态栏字体颜色中国移动的颜色改为白色（需要设置plist文件里的View controller-based status bar appearance属性为NO；）</div><div class="line">    [UIApplication sharedApplication].statusBarStyle=UIStatusBarStyleLightContent;</div><div class="line">//隐藏项目中得状态栏</div><div class="line"> [[UIApplication sharedApplication]setStatusBarHidden:YES withAnimation:UIStatusBarAnimationFade];</div><div class="line"></div><div class="line">info.plist文件中</div><div class="line">Status bar is initially hidden   yes</div><div class="line"></div><div class="line">View controller-based status bar appearance   NO</div></pre></td></tr></table></figure></p>
<p><strong>11.通过抖动的方式提示用户textField文本输入框的text值为空或错误</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">//TextField的晃动:Begin  </div><div class="line">@interface UITextField(shake)  </div><div class="line">  </div><div class="line">- (void)shake;  </div><div class="line">  </div><div class="line">@end  </div><div class="line">  </div><div class="line">@implementation UITextField(shake)  </div><div class="line">  </div><div class="line">- (void)shake  </div><div class="line">&#123;  </div><div class="line">    CAKeyframeAnimation *animationKey = [CAKeyframeAnimationanimationWithKeyPath:@&quot;position&quot;];  </div><div class="line">    [animationKey setDuration:0.5f];  </div><div class="line">      </div><div class="line">    NSArray *array = [[NSArrayalloc] initWithObjects:  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x, self.center.y)],  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x-5, self.center.y)],  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x+5, self.center.y)],  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x, self.center.y)],  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x-5, self.center.y)],  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x+5, self.center.y)],  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x, self.center.y)],  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x-5, self.center.y)],  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x+5, self.center.y)],  </div><div class="line">                      [NSValuevalueWithCGPoint:CGPointMake(self.center.x, self.center.y)],  </div><div class="line">                      nil];  </div><div class="line">    [animationKey setValues:array];  </div><div class="line">    [array release];  </div><div class="line">      </div><div class="line">    NSArray *times = [[NSArrayalloc] initWithObjects:  </div><div class="line">                      [NSNumbernumberWithFloat:0.1f],  </div><div class="line">                      [NSNumbernumberWithFloat:0.2f],  </div><div class="line">                      [NSNumbernumberWithFloat:0.3f],  </div><div class="line">                      [NSNumbernumberWithFloat:0.4f],  </div><div class="line">                      [NSNumbernumberWithFloat:0.5f],  </div><div class="line">                      [NSNumbernumberWithFloat:0.6f],  </div><div class="line">                      [NSNumbernumberWithFloat:0.7f],  </div><div class="line">                      [NSNumbernumberWithFloat:0.8f],  </div><div class="line">                      [NSNumbernumberWithFloat:0.9f],  </div><div class="line">                      [NSNumbernumberWithFloat:1.0f],  </div><div class="line">                      nil];  </div><div class="line">    [animationKey setKeyTimes:times];  </div><div class="line">    [times release];  </div><div class="line">      </div><div class="line">    [self.layeraddAnimation:animationKey forKey:@&quot;TextFieldShake&quot;];  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line">@end  </div><div class="line">//TextField的晃动:End</div></pre></td></tr></table></figure></p>
<p><strong>12.二维码图片中间添加logo</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">+(UIImage *)addImage:(UIImage *)image1 toImage:(UIImage *)image2</div><div class="line">&#123;</div><div class="line">    UIGraphicsBeginImageContext(image1.size);</div><div class="line"></div><div class="line">    //Draw image1</div><div class="line">    [image1 drawInRect:CGRectMake(0, 0, image1.size.width, image1.size.height)];</div><div class="line">    </div><div class="line">    //Draw image2</div><div class="line">    </div><div class="line">    [image2 drawInRect:CGRectMake((image1.size.width - 60)/ 2, (image1.size.height - 60)/2, 60, 60)];</div><div class="line">    </div><div class="line">    UIImage *resultImage=UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    </div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    </div><div class="line">    return resultImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>13.定义枚举的几种方法</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">方法一</div><div class="line">typedef NS_ENUM(NSInteger, enumCellButtonIndex)</div><div class="line">&#123;</div><div class="line">    eCBIFirst,</div><div class="line">    eCBISecond,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">方法二</div><div class="line">typedef enum &#123;</div><div class="line">    commonTag,</div><div class="line">    differentTag,</div><div class="line">    noCommonTag   </div><div class="line">&#125;SortedTag;</div><div class="line"></div><div class="line">方法三</div><div class="line">typedef enum : NSUInteger &#123;</div><div class="line">    eQDTabViewTypeTop,</div><div class="line">    eQDTabViewTypeBottom,</div><div class="line">    eQDTabViewTypeBottomHideBar</div><div class="line">&#125; QDTabViewType;</div></pre></td></tr></table></figure></p>
<p><strong>14.KVO解决特殊字段（与关键词一样的敏感词）</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">-(void)setValue:(id)value forUndefinedKey:(NSString *)key </div><div class="line">&#123; </div><div class="line">if ([key isEqualToString:@&quot;id&quot;]) &#123; </div><div class="line">self.ID = value; </div><div class="line">&#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>15.TabBar上添加消息提示小红点</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">1. 如果有数字，直接使用 viewController.tabBarItem.badgeValue = @&quot;1&quot;;</div><div class="line">2. 没有数字，自己往tabbar加subView。</div><div class="line">    需要注意的是坐标x，y一定要是整数，否则会有模糊。</div><div class="line">        UIImageView *dotImage = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@&quot;personinfo_unread@2x.png&quot;]];</div><div class="line">        dotImage.backgroundColor = [UIColor clearColor];</div><div class="line">        dotImage.tag = RED_DOT_TAG;</div><div class="line">        CGRect tabFrame = tabbarController.tabBar.frame;</div><div class="line">        CGFloat x = ceilf(0.94 * tabFrame.size.width);</div><div class="line">        CGFloat y = ceilf(0.2 * tabFrame.size.height);</div><div class="line">        dotImage.frame = CGRectMake(x, y, 6, 6);</div><div class="line">        [tabbarController.tabBar addSubview:dotImage];</div><div class="line">        [dotImage release];</div></pre></td></tr></table></figure></p>
<p><strong>16.让程序在后台较长久的运行</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// AppDelegate.h文件</div><div class="line">@property (assign, nonatomic) UIBackgroundTaskIdentifier backgroundUpdateTask;</div><div class="line"></div><div class="line">// AppDelegate.m文件</div><div class="line">- (void)applicationDidEnterBackground:(UIApplication *)application</div><div class="line">&#123;</div><div class="line">    [self beingBackgroundUpdateTask];</div><div class="line">    // 在这里加上你需要长久运行的代码</div><div class="line">    [self endBackgroundUpdateTask];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)beingBackgroundUpdateTask</div><div class="line">&#123;</div><div class="line">    self.backgroundUpdateTask = [[UIApplication sharedApplication] beginBackgroundTaskWithExpirationHandler:^&#123;</div><div class="line">        [self endBackgroundUpdateTask];</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)endBackgroundUpdateTask</div><div class="line">&#123;</div><div class="line">    [[UIApplication sharedApplication] endBackgroundTask: self.backgroundUpdateTask];</div><div class="line">    self.backgroundUpdateTask = UIBackgroundTaskInvalid;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>17.几种小的概念和方法</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">    1、sleep</div><div class="line">    [NSThread sleepForTimeInterval:4];</div><div class="line">     2、活动指示器控件</div><div class="line">    UIActivityIndicatorView</div><div class="line">     3、 _cmd的使用</div><div class="line">     _cmd是iOS内置变量，始终指向当前方法的selector</div><div class="line">     4、状态加入事件通知中心</div><div class="line">     [center addObserver:self selector:@selector(applicationWillResignActive)        name:UIApplicationWillResignActiveNotification  object:nil];</div><div class="line">     5、用NSUserDefault保存用户数据</div><div class="line">      使用方法：  </div><div class="line">          保存：</div><div class="line">          NSInteger selectedIndex = self.segmentedControl.selectedSegmentIndex;          [[NSUserDefaults standardUserDefaults] setInteger:selectedIndex          forKey:@&quot;selectedIndex&quot;];</div><div class="line">         取出：</div><div class="line">          NSNumber *indexNumber = indexNumber = [[NSUserDefaults standardUserDefaults]          objectForKey:@&quot;selectedIndex&quot;];          if (indexNumber) &#123;           NSInteger selectedIndex = [indexNumber intValue];           self.segmentedControl.selectedSegmentIndex = selectedIndex;&#125;</div></pre></td></tr></table></figure></p>
<p><strong>18.有三种方式可以引入静态库文件</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">第一种方式：直接将对应平台的.a文件拖拽至Xcode工程左侧的Groups&amp;Files中，缺点是每次在真机和模拟器编译时都需要重新添加.a文件；</div><div class="line">第二种方式：使用lipo命令将设备和模拟器的.a合并成一个通用的.a文件，将合并后的通用.a文件拖拽至工程中即可，具体命令如下： lipo -create Release-iphoneos/libbaidumapapi.a Release-iphonesimulator/libbaidumapapi.a -output libbaidumapapi.a</div><div class="line">第三种方式：</div><div class="line">1. 将API的libs文件夹拷贝到您的Application工程根目录下</div><div class="line">2. 在Xcode的Project -&gt; Edit Active Target -&gt; Build -&gt; Linking -&gt; Other Linker Flags中添加-ObjC</div><div class="line">3. 设置静态库的链接路径，在Xcode的Project -&gt; Edit Active Target -&gt; Build -&gt; Search Path -&gt; Library Search Paths中添加您的静态库目录，比如&quot;$(SRCROOT)/../libs/Release$(EFFECTIVE_PLATFORM_NAME)&quot;，$(SRCROOT)宏代表您的工程文件目录，$(EFFECTIVE_PLATFORM_NAME)宏代表当前配置是OS还是simulator</div><div class="line">注:静态库中采用ObjectC++实现，因此需要您保证您工程中至少有一个.mm后缀的源文件(您可以将任意一个.m后缀的文件改名为.mm)，或者在工程属性中指定编译方式，即将Xcode的Project -&gt; Edit Active Target -&gt; Build -&gt; GCC4.2 - Language -&gt; Compile Sources As设置为&quot;Objective-C++&quot;</div></pre></td></tr></table></figure></p>
<p><strong>19.SDWebImage清除缓存</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">清除缓存：</div><div class="line">[[SDImageCache sharedImageCache] clearDisk];</div><div class="line">[[SDImageCache sharedImageCache] clearMemory];</div></pre></td></tr></table></figure></p>
<p><strong>20.view加阴影</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">view.layer.shadowOpacity = 0.5;// 阴影透明度</div><div class="line">view.layer.shadowColor = [UIColor grayColor].CGColor;// 阴影的颜色</div><div class="line">view.layer.shadowRadius = 3;// 阴影扩散的范围控制</div><div class="line">view.layer.shadowOffset = CGSizeMake(1, 1);// 阴影的范围</div></pre></td></tr></table></figure></p>
<p><strong>21.将view加到UIWindow上</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">UIWindow* currentWindow = [UIApplication sharedApplication].keyWindow;</div><div class="line">[currentWindow addSubview:drawView];</div><div class="line">_drawView = drawView;</div></pre></td></tr></table></figure></p>
<p><strong>22.AES加密解密。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// NSData+AES256.h</div><div class="line"></div><div class="line">#import &lt;Foundation/Foundation.h&gt; </div><div class="line">#import &lt;CommonCrypto/CommonDigest.h&gt; </div><div class="line">#import &lt;CommonCrypto/CommonCryptor.h&gt; </div><div class="line">@interface NSData(AES256)</div><div class="line">- (NSData *)aes256_encrypt:(NSString *)key;</div><div class="line">- (NSData *)aes256_decrypt:(NSString *)key;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">// NSData+AES256.m</div><div class="line">//#import &quot;NSData+AES256.h&quot;</div><div class="line">@implementation NSData (AES256)</div><div class="line">/** 加密 */</div><div class="line">- (NSData*)aes256_encrypt:(NSString *)key</div><div class="line">&#123;</div><div class="line">char keyPtr[kCCKeySizeAES256 + 1];</div><div class="line">bzero(keyPtr, sizeof(keyPtr));</div><div class="line">[key getCString:keyPtr maxLength:sizeof(keyPtr) encoding:NSUTF8StringEncoding];</div><div class="line">NSUInteger dataLength = [self length];</div><div class="line">size_t bufferSize = dataLength + kCCBlockSizeAES128;</div><div class="line">void *buffer = malloc(bufferSize);</div><div class="line">size_t numBytesEncrypted = 0;</div><div class="line">CCCryptorStatus cryptStatus = CCCrypt(kCCEncrypt, kCCAlgorithmAES128, kCCOptionPKCS7Padding | kCCOptionECBMode, keyPtr, kCCBlockSizeAES128, NULL, [self bytes], dataLength, buffer, bufferSize, &amp;numBytesEncrypted);</div><div class="line"></div><div class="line">if (cryptStatus == kCCSuccess) &#123;</div><div class="line">return [NSData dataWithBytesNoCopy:buffer length:numBytesEncrypted];</div><div class="line">&#125;</div><div class="line"></div><div class="line">free(buffer);</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/** 解密 */</div><div class="line">- (NSData*)aes256_decrypt:(NSString *)key</div><div class="line">&#123;</div><div class="line">char keyPtr[kCCKeySizeAES256 + 1];</div><div class="line">bzero(keyPtr, sizeof(keyPtr));</div><div class="line">[key getCString:keyPtr maxLength:sizeof(keyPtr) encoding:NSUTF8StringEncoding];</div><div class="line">NSUInteger dataLength = [self length];</div><div class="line">size_t bufferSize = dataLength + kCCBlockSizeAES128;</div><div class="line">void* buffer = malloc(bufferSize);</div><div class="line">size_t numBytesDecrypted = 0;</div><div class="line">CCCryptorStatus cryptStatus = CCCrypt(kCCDecrypt, kCCAlgorithmAES128, kCCOptionPKCS7Padding | kCCOptionECBMode, keyPtr, kCCBlockSizeAES128, NULL, [self bytes], dataLength, buffer, bufferSize, &amp;numBytesDecrypted);</div><div class="line"></div><div class="line">if (cryptStatus == kCCSuccess) &#123;</div><div class="line">return [NSData dataWithBytesNoCopy:buffer length:numBytesDecrypted];</div><div class="line">&#125;</div><div class="line">free(buffer);</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p><strong>22.GCD异步</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">//通知主线程刷新</div><div class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">//回调或者说是通知主线程刷新，</div><div class="line">&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><strong>23.头部图片下拉放大</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-(void)scrollViewDidScroll:(UIScrollView *)scrollView&#123;</div><div class="line">        CGFloat heightWidthRatio = VideoHeaderHeight/ScreenWidth;</div><div class="line">        CGRect frame = self.headerView.frame;</div><div class="line">        frame.origin.y = offsetY;</div><div class="line">        frame.origin.x = offsetY/heightWidthRatio/2;</div><div class="line">        frame.size.height = -offsetY+VideoHeaderHeight;</div><div class="line">        frame.size.width=(-offsetY+VideoHeaderHeight)/heightWidthRatio;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>24.获取版本号，DisPlayName等</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSDictionary *infoDict = [[NSBundle mainBundle] infoDictionary];</div><div class="line"> _nameLabel.text = [infoDict objectForKey:@&quot;CFBundleDisplayName&quot;];</div><div class="line"> _versionLabel.text = [NSString stringWithFormat:@&quot;版本号:  V%@&quot;,[infoDict objectForKey:@&quot;CFBundleShortVersionString&quot;]];</div><div class="line"> _rightsLabel.text = [NSString stringWithFormat:@&quot;%@ Jucailife.cn京ICP备 15058272&quot;,[[NSDate date] year]];</div></pre></td></tr></table></figure></p>
<p><strong>25.常用监听事件 </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">**键盘**</div><div class="line">//键盘出现时</div><div class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(keyboardWasShown:) name:UIKeyboardWillShowNotification object:nil];</div><div class="line">//键盘收回时</div><div class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(keyboardWillHide:) name:UIKeyboardWillHideNotification object:nil];</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">**TextField**</div><div class="line">//适用场景，打字时弹出suggestion</div><div class="line">//TextField 编辑状态时(通知)</div><div class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(textFieldChanged:) name:UITextFieldTextDidChangeNotification object:textField];</div><div class="line">//或者 addTarget</div><div class="line">UIControlEventEditingDidBegin = 1 &lt;&lt; 16,//1 &lt;&lt; 17 代表:2的17次方 </div><div class="line">UIControlEventEditingChanged = 1 &lt;&lt; 17,//1 &lt;&lt; 18 代表:2的18次方</div><div class="line">UIControlEventEditingDidEnd = 1 &lt;&lt; 18,//1 &lt;&lt; 19 代表:2的19次方</div><div class="line">UIControlEventEditingDidEndOnExit = 1 &lt;&lt; 19,</div><div class="line">[field addTarget:self action:@selector(textFieldDidChanged) forControlEvents:UIControlEventEditingDidBegin | UIControlEventValueChanged | UIControlEventEditingDidEnd];</div></pre></td></tr></table></figure>
<p><strong>26.监听ScrollView的滚动 </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView</div><div class="line">&#123;</div><div class="line">//偏移量 </div><div class="line">CGFloat offsetY = scrollView.contentOffset.y;</div><div class="line"></div><div class="line">if (offsetY &gt; 0) &#123; //往上滑</div><div class="line"></div><div class="line">&#125;else &#123;//往下滑</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">//加速度 </div><div class="line">UIPanGestureRecognizer* pan = scrollView.panGestureRecognizer;</div><div class="line">CGFloat velocity = [pan velocityInView:scrollView].y;</div><div class="line">if (velocity&lt;-5) &#123; //上</div><div class="line"></div><div class="line">&#125;else if (velocity&gt;5) &#123; //下</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>27.字符串编码</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">有的时候咱们会碰见字符串里有一些特殊字符在转成URL的时候 会出现转换不了的情况，这个时候需要对字符串进行编码9.0以前使用stringByAddingPercentEscapesUsingEncoding</div><div class="line">9.0之后使用stringByAddingPercentEncodingWithAllowedCharacters</div><div class="line"></div><div class="line">NSString *resourcePath = @&quot;http://www.baidu.com?tickets=[&#123;\&quot;num\&quot;:\&quot;1\&quot;,\&quot;priceId\&quot;:\&quot;8a82824756\&quot;&#125;]&quot;;                               </div><div class="line"></div><div class="line">NSString *encodePath ;</div><div class="line"></div><div class="line">if (!IOS7_OR_LATER) &#123;</div><div class="line">   encodePath = [resourcePath stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding];</div><div class="line">&#125;else&#123;</div><div class="line">   encodePath = [resourcePath stringByAddingPercentEncodingWithAllowedCharacters:[NSCharacterSet characterSetWithCharactersInString:@&quot;`#%^&#123;&#125;\&quot;[]|\\&lt;&gt; &quot;].invertedSet];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>28.ScrollView的ContentOffSet</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1438251-95728fc7b27547ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ContentOffSet"></p>
<p><strong>29.ImageView填充方式。</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1438251-b8e6dd390feccff4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ImageView填充方式"></p>
<p><strong>30.绘制一条虚线。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"> **lineFrame: 虚线的frame</div><div class="line"> **length:    虚线中短线的宽度</div><div class="line"> **spacing:   虚线中短线之间的间距</div><div class="line"> **color:     虚线中短线的颜色</div><div class="line">*/</div><div class="line">+(UIView *)creatDashedLineWithFrame:(CGRect)lineFrame lineLenght:(int)length lineSpacing:(int)spacing lineColor:(UIColor *)color&#123;</div><div class="line">    </div><div class="line">    UIView *dashLine = [[UIView alloc]initWithFrame:lineFrame];</div><div class="line">    dashLine.backgroundColor = [UIColor clearColor];</div><div class="line">    CAShapeLayer *shapeLayer = [CAShapeLayer layer];</div><div class="line">    [shapeLayer setBounds:dashLine.bounds];</div><div class="line">    [shapeLayer setPosition:CGPointMake(CGRectGetWidth(dashLine.frame)/2, CGRectGetHeight(dashLine.frame))];</div><div class="line">    [shapeLayer setFillColor:[UIColor clearColor].CGColor];</div><div class="line">    [shapeLayer setStrokeColor:color.CGColor];</div><div class="line">    [shapeLayer setLineWidth:CGRectGetHeight(dashLine.frame)];</div><div class="line">    [shapeLayer setLineJoin:kCALineJoinRound];</div><div class="line">    [shapeLayer setLineDashPattern:[NSArray arrayWithObjects:[NSNumber numberWithInt:length],[NSNumber numberWithInt:spacing],nil]];</div><div class="line">    CGMutablePathRef path = CGPathCreateMutable();</div><div class="line">    CGPathMoveToPoint(path, NULL, 0, 0);</div><div class="line">    CGPathAddLineToPoint(path, NULL, CGRectGetWidth(dashLine.frame), 0);</div><div class="line">    [shapeLayer setPath:path];</div><div class="line">    CGPathRelease(path);</div><div class="line">    [dashLine.layer addSublayer:shapeLayer];</div><div class="line">    return dashLine;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>31. 播放视频。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#import &lt;MediaPlayer/MediaPlayer.h&gt;</div><div class="line"></div><div class="line">// =================================================</div><div class="line">#pragma mark - 播放视频</div><div class="line">// =================================================</div><div class="line">+(void)playVideoWithUrl:(NSString *)url andController:(UIViewController *)controller&#123;</div><div class="line">    </div><div class="line">    MPMoviePlayerViewController *playerVC = [[MPMoviePlayerViewController alloc] initWithContentURL:[NSURL URLWithString:url]];</div><div class="line">    playerVC.moviePlayer.movieSourceType = MPMovieSourceTypeFile;</div><div class="line">    //    playerVC.moviePlayer.repeatMode = MPMovieRepeatModeOne;</div><div class="line">    [controller presentMoviePlayerViewControllerAnimated:playerVC];</div><div class="line">    </div><div class="line">&#125;</div><div class="line">+(void)playVideoWithLocalPath:(NSString *)localDocumentName andController:(UIViewController *)controller&#123;</div><div class="line">    </div><div class="line">    NSString *path = [[NSBundle mainBundle] pathForResource:localDocumentName ofType:nil];</div><div class="line">    NSURL *url = [[NSURL alloc] initFileURLWithPath:path];</div><div class="line">    MPMoviePlayerViewController *playerVC = [[MPMoviePlayerViewController alloc] initWithContentURL:url];</div><div class="line">    playerVC.moviePlayer.movieSourceType = MPMovieSourceTypeFile;</div><div class="line">    //    playerVC.moviePlayer.repeatMode = MPMovieRepeatModeOne;</div><div class="line">    [controller presentMoviePlayerViewControllerAnimated:playerVC];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> 32. iPhone屏幕尺寸、分辨率及适配。</strong><br>   <a href="http://blog.csdn.net/phunxm/article/details/42174937#t1" target="_blank" rel="external">看这个大神的帖子足够</a></p>
<p><strong> 33. 验证邮箱、电话、和QQ </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">- (BOOL) validateEmail:(NSString *)email</div><div class="line">&#123;</div><div class="line">NSString *emailRegex = @&quot;[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\\\.[A-Za-z]&#123;2,4&#125;&quot;;</div><div class="line">NSPredicate *emailTest = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;, emailRegex];</div><div class="line">return [emailTest evaluateWithObject:email];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//手机号码验证</div><div class="line">- (BOOL)validateMobile:(NSString *)phone</div><div class="line">&#123;</div><div class="line">NSString *MOBILE = @&quot;^1[34578]\\\\d&#123;9&#125;$&quot;;</div><div class="line">NSPredicate *regexTestMobile = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;,MOBILE];</div><div class="line">if ([regexTestMobile evaluateWithObject:phone]) &#123;</div><div class="line">return YES;</div><div class="line">&#125;else &#123;</div><div class="line">return NO;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//QQ号码验证</div><div class="line">- (BOOL)validateQQ:(NSString *)qq&#123;</div><div class="line">NSString *QQ = @&quot;[1-9][0-9]&#123;4,&#125;&quot;;</div><div class="line">NSPredicate *regexTestQQ = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;,QQ];</div><div class="line">if ([regexTestQQ evaluateWithObject:qq]) &#123;</div><div class="line">return YES;</div><div class="line">&#125;else &#123;</div><div class="line">return NO;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong> 34. UISegmentedControl（直接拷来用）</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">-(UISegmentedControl *)segementControl&#123;</div><div class="line">if (_segementControl == nil) &#123;</div><div class="line">UISegmentedControl *segmentedControl = [[UISegmentedControl alloc] initWithItems:@[@&quot;餐馆&quot;, @&quot;菜单&quot;]];</div><div class="line">segmentedControl.frame = CGRectMake((ScreenWidth-150)/2, 10, 150, 30);</div><div class="line">// 设置进入页面后的所处的位置</div><div class="line">segmentedControl.selectedSegmentIndex = 0;</div><div class="line">//选中的颜色</div><div class="line">segmentedControl.tintColor = [UIColor redColor];</div><div class="line">[segmentedControl addTarget:self action:@selector(segmentedControlValueChanged:)   forControlEvents:UIControlEventValueChanged];</div><div class="line">[self.segementWrapView addSubview:segmentedControl];</div><div class="line">_segementControl = segmentedControl;</div><div class="line">&#125;</div><div class="line">return _segementControl;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)segmentedControlValueChanged:(UISegmentedControl *) segmentedControl &#123;</div><div class="line">if (0 == segmentedControl.selectedSegmentIndex) &#123;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> 35. iOS一键加群</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (BOOL)joinGroup:(NSString *)groupUin key:(NSString *)key&#123;</div><div class="line"></div><div class="line">NSString *urlStr = [NSString stringWithFormat:@&quot;mqqapi://card/show_pslcard?   src_type=internal&amp;version=1&amp;uin=%@&amp;key=%@&amp;card_type=group&amp;source=external&quot;, @&quot;240555441&quot;,@&quot;60d319547ddffeacefe646f0d273e988a26dc70065bdedfd6a63c484e3c353c0&quot;];</div><div class="line">NSURL *url = [NSURL URLWithString:urlStr];</div><div class="line">if([[UIApplication sharedApplication] canOpenURL:url])&#123;</div><div class="line">[[UIApplication sharedApplication] openURL:url];</div><div class="line">return YES;</div><div class="line">&#125;else return NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> 36.CLLocation的一些黑魔法</strong></p>
<p><strong>(1).pausesLocationUpdatesAutomatically</strong></p>
<p>locationManager.pausesLocationUpdatesAutomatically = NO;<br>贴上一段官网对这个属性的描述：<br><strong>Allowing the location manager to pause updates can improve battery life on the target device without sacrificing location data. When this property is set to YES, the location manager pauses updates (and powers down the appropriate hardware) at times when the location data is unlikely to change. For example, if the user stops for food while using a navigation app, the location manager might pause updates for a period of time. You can help the determination of when to pause location updates by assigning a value to the activityTypeproperty.</strong></p>
<p>大致的意思就是如果这个属性设置成YES（默认的也是YES），那么系统会检测如果设备有一段时间没有移动，就会自动停掉位置更新服务。这里需要注意的是，一旦定位服务停止了，只有当用户再次开启App的时候定位服务才会重新启动。<br>这里的一段时间是系统自动判定的，可以通过设置activityTypeproperty这个属性来决定这个时间的长短。<br>API的意思是，类似导航类的App,系统检验的时间会稍长一点，想运动类的App，就会比导航类的短一点。但是具体时间还是由系统来决定。</p>
<p><strong>(2).headingFilter</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">locationManager.headingFilter = 45;//设置只有当设备方向的改变值超过该属性值时才激发delegate的方法。</div><div class="line">- (void)locationManager:(CLLocationManager *)manager didUpdateHeading:(CLHeading *)newHeading</div><div class="line">&#123;</div><div class="line">MKAnnotationView *anv = [_mapView viewForAnnotation:_mapView.userLocation];</div><div class="line">anv.transform = CGAffineTransformMakeRotation(newHeading.magneticHeading/360.0*2*M_PI);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>(3).deferredUpdates</strong><br>默认地，定位服务的代理会每秒钟都更新一次位置，这样对电池的消耗量会特别地大。除了设置pausesLocationUpdatesAutomatically这个属性以外，iOS还提供了DeferredUpdates的机制。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">官方API文档：</div><div class="line"></div><div class="line">- (void)allowDeferredLocationUpdatesUntilTraveled:(CLLocationDistance)distance  timeout:(NSTimeInterval)timeout</div></pre></td></tr></table></figure></p>
<p><strong>distance</strong>：<br>The distance (in meters) from the current location that must be travelled before event delivery resumes. To specify an unlimited distance, pass the CLLocationDistanceMaxconstant.<br><strong>timeout</strong>：<br>The amount of time (in seconds) from the current time that must pass before event delivery resumes. To specify an unlimited amount of time, pass the CLTimeIntervalMax constant.</p>
<p>就是你可以设置让系统每隔多远或者每隔多长时间更新一次位置。注意是“或”的关系，满足一个就会更新。<br>使用这个方法有很多要注意的地方：<br>desiredAccuracy必须设置成kCLLocationAccuracyBest<br>distanceFilter必须设置成kCLErrorDeferredDistanceFiltered<br>必须能够使用GPS进行定位（而不仅仅是移动数据或者Wi-Fi）<br>非常重要的一点，DeferredUpdates只会出现在设备进入低耗电量的状态，App运行在前台或者设备连接在Xcode上正在调试是不会触发的。（所以不可能在Debug的时候打印Log来检验，要调试的话，需要写一些Log存在本地的数据库）</p>
<p><strong> 37.真机中.Plist文件的读写</strong><br>.Plist文件的读写默认真机不管用,因为在真机环境下,App在Xcode中的Resources文件夹都是不可写的.所以我们要在App第一次运行时将需要修改且长久保存的数据放到Document目录下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</div><div class="line">&#123;</div><div class="line">[self initDataFile];</div><div class="line">return YES；</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">//在Document目录中初始化地图数据文件,因为该目录下文件可写且可以持久保存</div><div class="line"></div><div class="line">-(void)initDataFile</div><div class="line">&#123;</div><div class="line">NSString *docPath = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES)[0];</div><div class="line"></div><div class="line">//取得目标文件路径</div><div class="line">NSString *path = [docPath stringByAppendingPathComponent:@&quot;titleList.plist&quot;];</div><div class="line">NSFileManager *fm = [NSFileManager defaultManager];</div><div class="line">//如果目标文件不存在说明是App第一次运行,需要将相关可修改数据文件拷贝至目标路径.</div><div class="line">if (![fm fileExistsAtPath:path]) &#123;</div><div class="line">NSError *error = nil;</div><div class="line">//取得源文件路径</div><div class="line">NSString *paths = [[NSBundle mainBundle] pathForResource:@&quot;titleList&quot; ofType:@&quot;plist&quot;];</div><div class="line">if (![fm copyItemAtPath:paths toPath:path error:&amp;error]) &#123;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//.Plist文件的读写</div><div class="line">NSArray *arrPaths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</div><div class="line">NSString *strDocBase = ([arrPaths count] &gt; 0) ? [arrPaths objectAtIndex:0] : nil;</div><div class="line">_path = [strDocBase stringByAppendingPathComponent:@&quot;titleList.plist&quot;];</div><div class="line">//读取数据</div><div class="line">NSArray *data = [NSArray arrayWithContentsOfFile:_path];</div><div class="line">//写入数据</div><div class="line">[_datas writeToFile:_path atomically:YES];</div></pre></td></tr></table></figure>
<p><strong> 38.UITableView的Group样式下顶部空白处理</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//分组列表头部空白处理</div><div class="line">UIView *view = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 0, 0.1)];</div><div class="line">self.tableView.tableHeaderView = view;</div></pre></td></tr></table></figure></p>
<p><strong> 39.获取某个view所在的控制器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (UIViewController *)viewController&#123;</div><div class="line"></div><div class="line">UIViewController *viewController = nil;</div><div class="line">UIResponder *next = self.nextResponder;</div><div class="line">while (next)&#123;</div><div class="line">if ([next isKindOfClass:[UIViewController class]])&#123;</div><div class="line">viewController = (UIViewController *)next;</div><div class="line">break;</div><div class="line">&#125;</div><div class="line">next = next.nextResponder;</div><div class="line">&#125;</div><div class="line">return viewController;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> 40.两种方法删除NSUserDefaults所有记录</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//方法一</div><div class="line">NSString *appDomain = [[NSBundle mainBundle] bundleIdentifier];</div><div class="line">[[NSUserDefaults standardUserDefaults] removePersistentDomainForName:appDomain];</div><div class="line">//方法二</div><div class="line">- (void)resetDefaults</div><div class="line">&#123;</div><div class="line">NSUserDefaults * defs = [NSUserDefaults standardUserDefaults];</div><div class="line">NSDictionary * dict = [defs dictionaryRepresentation];</div><div class="line">for (id key in dict)</div><div class="line">&#123;</div><div class="line">[defs removeObjectForKey:key];</div><div class="line">&#125;</div><div class="line">[defs synchronize];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> 41.获取图片某一点的颜色</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- (UIColor*) getPixelColorAtLocation:(CGPoint)point inImage:(UIImage *)image</div><div class="line">&#123;</div><div class="line">UIColor* color = nil;</div><div class="line">CGImageRef inImage = image.CGImage;</div><div class="line">CGContextRef cgctx = [self createARGBBitmapContextFromImage:inImage];</div><div class="line">if (cgctx == NULL) &#123;</div><div class="line">return nil; /* error */</div><div class="line">&#125;</div><div class="line">size_t w = CGImageGetWidth(inImage);</div><div class="line">size_t h = CGImageGetHeight(inImage);</div><div class="line">CGRect rect = &#123;&#123;0,0&#125;,&#123;w,h&#125;&#125;;</div><div class="line">CGContextDrawImage(cgctx, rect, inImage);</div><div class="line">unsigned char* data = CGBitmapContextGetData (cgctx);</div><div class="line">if (data != NULL) &#123;</div><div class="line">int offset = 4*((w*round(point.y))+round(point.x));</div><div class="line">int alpha =  data[offset];</div><div class="line">int red = data[offset+1];</div><div class="line">int green = data[offset+2];</div><div class="line">int blue = data[offset+3];</div><div class="line">color = [UIColor colorWithRed:(red/255.0f) green:(green/255.0f) blue:</div><div class="line">(blue/255.0f) alpha:(alpha/255.0f)];</div><div class="line">&#125;</div><div class="line">CGContextRelease(cgctx);</div><div class="line">if (data) &#123;</div><div class="line">free(data);</div><div class="line">&#125;</div><div class="line">return color;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> 42.禁止锁屏
</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">默认情况下，当设备一段时间没有触控动作时，iOS会锁住屏幕。但有一些应用是不需要锁屏的，比如视频播放器。</div><div class="line">[UIApplication sharedApplication].idleTimerDisabled = YES;</div><div class="line">或</div><div class="line">[[UIApplication sharedApplication] setIdleTimerDisabled:YES];</div></pre></td></tr></table></figure></p>
<p><strong> 43.模态推出透明界面</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">UIViewController *vc = [[UIViewController alloc] init];</div><div class="line">UINavigationController *na = [[UINavigationController alloc] initWithRootViewController:vc];</div><div class="line">if ([[[UIDevice currentDevice] systemVersion] floatValue] &gt;= 8.0)</div><div class="line">&#123;</div><div class="line">na.modalPresentationStyle = UIModalPresentationOverCurrentContext;</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">self.modalPresentationStyle=UIModalPresentationCurrentContext;</div><div class="line">&#125;</div><div class="line">[self presentViewController:na animated:YES completion:nil];</div></pre></td></tr></table></figure></p>
<p><strong> 44.iOS 获取汉字的拼音</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">+ (NSString *)transform:(NSString *)chinese&#123;</div><div class="line">//将NSString装换成NSMutableString</div><div class="line">NSMutableString *pinyin = [chinese mutableCopy];</div><div class="line">//将汉字转换为拼音(带音标)</div><div class="line">CFStringTransform((__bridge CFMutableStringRef)pinyin, NULL, kCFStringTransformMandarinLatin, NO);</div><div class="line">NSLog(@&quot;%@&quot;, pinyin);</div><div class="line">//去掉拼音的音标</div><div class="line">CFStringTransform((__bridge CFMutableStringRef)pinyin, NULL, kCFStringTransformStripCombiningMarks, NO);</div><div class="line">NSLog(@&quot;%@&quot;, pinyin);</div><div class="line">//返回最近结果</div><div class="line">return pinyin;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> 45.判断对象是否遵循了某协议</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if ([self.selectedController conformsToProtocol:@protocol(RefreshPtotocol)])</div><div class="line">&#123;</div><div class="line">[self.selectedController performSelector:@selector(onTriggerRefresh)];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> 46.判断view是不是指定视图的子视图
</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">BOOL isView = [textView isDescendantOfView:self.view];</div></pre></td></tr></table></figure></p>
<p><strong> 47.取消UICollectionView的隐式动画</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">UICollectionView在reloadItems的时候，默认会附加一个隐式的fade动画，有时候很讨厌，尤其是当你的cell是复合cell的情况下(比如cell使用到了UIStackView)。</div><div class="line"></div><div class="line">下面几种方法都可以帮你去除这些动画</div><div class="line"></div><div class="line">//方法一</div><div class="line">[UIView performWithoutAnimation:^&#123;</div><div class="line">[collectionView reloadItemsAtIndexPaths:@[[NSIndexPath indexPathForItem:index inSection:0]]];</div><div class="line">&#125;];</div><div class="line">//方法二</div><div class="line">[UIView animateWithDuration:0 animations:^&#123;</div><div class="line">[collectionView performBatchUpdates:^&#123;</div><div class="line">[collectionView reloadItemsAtIndexPaths:@[[NSIndexPath indexPathForItem:index inSection:0]]];</div><div class="line">&#125; completion:nil];</div><div class="line">&#125;];</div><div class="line">//方法三</div><div class="line">[UIView setAnimationsEnabled:NO];</div><div class="line">[self.trackPanel performBatchUpdates:^&#123;</div><div class="line">[collectionView reloadItemsAtIndexPaths:@[[NSIndexPath indexPathForItem:index inSection:0]]];</div><div class="line">&#125; completion:^(BOOL finished) &#123;</div><div class="line">[UIView setAnimationsEnabled:YES];</div><div class="line">&#125;];</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>后话：附上之前写的文章，欢迎指正：</strong><br><a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画
</a><br><a href="http://www.jianshu.com/p/88e20ba25eb9" target="_blank" rel="external">荼菜的iOS笔记–UIView的几个Block动画</a><br><a href="http://www.jianshu.com/p/fa53a2ffc0c6" target="_blank" rel="external">荼菜的iOS笔记–UITableViewCell的各种操作（刷新、插入、删除、动画）</a><br><a href="http://www.jianshu.com/p/6b850e1e6306" target="_blank" rel="external">荼菜的iOS笔记–一张图记住所有git命令行操作。</a><br><a href="http://www.jianshu.com/p/36346ccc1b92" target="_blank" rel="external">荼菜的iOS笔记–一张图告诉你程序员需要知道的这些网站。</a><br><a href="http://www.jianshu.com/p/77ca88d36682" target="_blank" rel="external">荼菜的iOS笔记–图片裁剪黑魔法。</a><br><a href="http://www.jianshu.com/p/443c60408035" target="_blank" rel="external">荼菜的iOS笔记–iOS自动打包脚本（Python）
</a><br><a href="http://www.jianshu.com/p/36b6443d5ad7" target="_blank" rel="external">荼菜的iOS笔记–我的编码规范参考。</a><br><a href="http://www.jianshu.com/p/3812ede99dca" target="_blank" rel="external">荼菜的iOS笔记–iOS基础优秀博客总结ToDoList</a><br><a href="http://www.jianshu.com/p/191b20c40143" target="_blank" rel="external">荼菜的iOS笔记–Xcode Tips</a><br><strong>当然，我还写过诗。。。</strong><br><a href="http://www.jianshu.com/p/f6927319f802" target="_blank" rel="external">光。</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/12/25/荼菜的iOS笔记-一些实用功能。/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-荼菜的iOS笔记-图片裁剪黑魔法。" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/07/荼菜的iOS笔记-图片裁剪黑魔法。/">荼菜的iOS笔记--图片裁剪黑魔法。</a>
    </h1>
  

        
        <a href="/2015/11/07/荼菜的iOS笔记-图片裁剪黑魔法。/" class="archive-article-date">
  	<time datetime="2015-11-07T14:33:50.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-11-07</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload-images.jianshu.io/upload_images/1438251-fe3420ef5538ddd7.gif?imageMogr2/auto-orient/strip" alt="LiangShi.gif"><br><strong>前言：最近在做一款对话交互式的美食机器人应用，目前内测阶段，效果如上图。最近闲暇之余会把期间总结的一些知识点写下来，做个总结。前期有段时间困扰了我很久一个问题由于工程中的图片数据抓取自不同平台，所以图片的大小尺寸不一定，而放置图片的imageView尺寸是一定的，不作任何处理的话会导致图片拉伸变形，因此找了好久解决办法，现把它拿出来。</strong></p>
<p>*图片裁剪代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line">#import &quot;UIImageView+WebCache.h&quot;</div><div class="line"></div><div class="line">@interface UIImageView (WebImage)</div><div class="line"></div><div class="line">/**</div><div class="line"> *  @author Tucai, 16-02-23 12:02:53</div><div class="line"> *</div><div class="line"> *  设置能够自动裁剪的网络图，基于SDWebImage实现</div><div class="line"> *</div><div class="line"> */</div><div class="line"></div><div class="line">// 模糊图渲染</div><div class="line">- (void)renderBlurredImageWithUrl:(NSString *)url placeholder:(UIImage *)placeholder completed:(imageDownloadCompletedBlock) completedBlock;</div><div class="line"></div><div class="line">//按比例缩放网络图片</div><div class="line"></div><div class="line">- (void)yg_setTrimImageWithUrl:(NSString *)url placeholderImage:(UIImage *)placeholder;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#import &quot;UIImageView+WebImage.h&quot;</div><div class="line">#import &quot;NSString+URLEncoding.h&quot;</div><div class="line">@implementation UIImageView (WebImage)</div><div class="line"></div><div class="line">#pragma mark - 模糊图渲染</div><div class="line"></div><div class="line">- (void)renderBlurredImageWithUrl:(NSString *)url placeholder:(UIImage *)placeholder completed:(imageDownloadCompletedBlock) completedBlock</div><div class="line">&#123;</div><div class="line">    // 这里必须开启内存缓存</div><div class="line">    [SDWebImageManager sharedManager].imageCache.shouldCacheImagesInMemory = YES;</div><div class="line">    </div><div class="line">    // 渲染背景</div><div class="line">    __weak typeof(self) ws = self;</div><div class="line">    [ws sd_setImageWithURL:[NSURL URLWithString:url] completed:^(UIImage *webImage, NSError *error, SDImageCacheType cacheType, NSURL *imageURL) &#123;</div><div class="line">        // 999 是一个标记</div><div class="line">        if (ws.tag != 999) &#123;</div><div class="line">            UIVisualEffectView *visualView = [[UIVisualEffectView alloc] initWithFrame:ws.bounds];</div><div class="line">            UIBlurEffect *effect = [UIBlurEffect effectWithStyle:UIBlurEffectStyleLight];</div><div class="line">            visualView.effect = effect;</div><div class="line">            NSLog(@&quot;only once&quot;);</div><div class="line">            [ws addSubview:visualView];</div><div class="line">            ws.tag = 999;</div><div class="line">        &#125;</div><div class="line">        ws.alpha =0.6;</div><div class="line">        ws.image = nil;</div><div class="line">        ws.image = webImage;</div><div class="line">        if (completedBlock) &#123;</div><div class="line">            completedBlock(webImage);</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - 裁剪图片</div><div class="line"></div><div class="line">- (void)yg_setTrimImageWithUrl:(NSString *)url placeholderImage:(UIImage *)placeholder&#123;</div><div class="line">    </div><div class="line">    __weak typeof(self) ws = self;</div><div class="line">        [SDWebImageManager sharedManager].imageCache.shouldCacheImagesInMemory = NO;</div><div class="line">    </div><div class="line">    [self sd_setImageWithURL:[NSURL URLWithString:url] placeholderImage:placeholder completed:^(UIImage *image, NSError *error, SDImageCacheType cacheType, NSURL *imageURL) &#123;</div><div class="line">        if (image) &#123;</div><div class="line">            UIImage *img=[self yg_trimImageWithImage:image];</div><div class="line">            ws.image=img;</div><div class="line">        &#125;else&#123;</div><div class="line">            ws.image =[self yg_trimImageWithImage:placeholder];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(UIImage *)yg_trimImageWithImage:(UIImage *)image&#123;</div><div class="line">    </div><div class="line">    //imageView的宽高比</div><div class="line">    CGFloat imageViewWidthHeightRatio =self.frame.size.width/self.frame.size.height;</div><div class="line">    //屏幕分辨率</div><div class="line">//    CGFloat imageScale = [[UIScreen mainScreen] scale];</div><div class="line"></div><div class="line">    CGFloat imageScale = 1;</div><div class="line">    </div><div class="line">    CGFloat imageWith = image.size.width*imageScale;</div><div class="line">    </div><div class="line">    CGFloat imageHeight =image.size.height*imageScale;</div><div class="line">    </div><div class="line">    //image的宽高比</div><div class="line">    CGFloat imageWidthHeightRatio =imageWith/imageHeight;</div><div class="line"></div><div class="line">    CGImageRef imageRef = nil;</div><div class="line">    </div><div class="line">    CGRect rect;</div><div class="line">    </div><div class="line">//    NSLog(@&quot;\nimageWith === %f\nimageHeight === %f\nImageView宽高比 == %f\nimageScale == %f&quot;,imageWith,imageHeight,imageViewWidthHeightRatio,imageScale);</div><div class="line"></div><div class="line">    </div><div class="line">    if (imageWidthHeightRatio&gt;imageViewWidthHeightRatio) &#123;</div><div class="line">        </div><div class="line">        rect = CGRectMake((imageWith-imageHeight*imageViewWidthHeightRatio)/2, 0, imageHeight*imageViewWidthHeightRatio, imageHeight);</div><div class="line">        </div><div class="line">    &#125;else if (imageWidthHeightRatio&lt;imageViewWidthHeightRatio) &#123;</div><div class="line">        </div><div class="line">        rect = CGRectMake(0, (imageHeight-imageWith/imageViewWidthHeightRatio)/2, imageWith, imageWith/imageViewWidthHeightRatio);</div><div class="line">        </div><div class="line">    &#125;else &#123;</div><div class="line">        rect = CGRectMake(0, 0, imageWith, imageHeight);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    imageRef = CGImageCreateWithImageInRect([image CGImage], rect);</div><div class="line">    UIImage *res = [UIImage imageWithCGImage:imageRef scale:imageScale orientation:UIImageOrientationUp];</div><div class="line"></div><div class="line">    /**</div><div class="line">     一定要，千万要release，否则等着内存泄露吧，稍微高清点的图一张图就是几M内存，很快App就挂了</div><div class="line">     */</div><div class="line">    CGImageRelease(imageRef);</div><div class="line">    </div><div class="line">    return res;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p><strong>后话：附上之前写的文章，欢迎指正：</strong></p>
<p><a href="http://www.jianshu.com/p/06dbbccd54f2" target="_blank" rel="external">荼菜的iOS笔记–Core Animation 核心动画
</a><br><a href="http://www.jianshu.com/p/88e20ba25eb9" target="_blank" rel="external">荼菜的iOS笔记–UIView的几个Block动画</a><br><a href="http://www.jianshu.com/p/1cff3fe34307" target="_blank" rel="external">荼菜的iOS笔记–一些实用功能。</a><br><a href="http://www.jianshu.com/p/fa53a2ffc0c6" target="_blank" rel="external">荼菜的iOS笔记–UITableViewCell的各种操作（刷新、插入、删除、动画）</a><br><a href="http://www.jianshu.com/p/6b850e1e6306" target="_blank" rel="external">荼菜的iOS笔记–一张图记住所有git命令行操作。</a><br><a href="http://www.jianshu.com/p/36346ccc1b92" target="_blank" rel="external">荼菜的iOS笔记–一张图告诉你程序员需要知道的这些网站。</a><br><a href="http://www.jianshu.com/p/443c60408035" target="_blank" rel="external">荼菜的iOS笔记–iOS自动打包脚本（Python）
</a><br><a href="http://www.jianshu.com/p/36b6443d5ad7" target="_blank" rel="external">荼菜的iOS笔记–我的编码规范参考。</a><br><a href="http://www.jianshu.com/p/3812ede99dca" target="_blank" rel="external">荼菜的iOS笔记–iOS基础优秀博客总结ToDoList</a><br><a href="http://www.jianshu.com/p/191b20c40143" target="_blank" rel="external">荼菜的iOS笔记–Xcode Tips</a><br><strong>当然，我还写过诗。。。</strong><br><a href="http://www.jianshu.com/p/f6927319f802" target="_blank" rel="external">光。</a>  </p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/11/07/荼菜的iOS笔记-图片裁剪黑魔法。/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 TuCai
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true,
		showTags: true
	}
</script>

<script>!function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="./",n(0)}([function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,n){var e=/\/|index.html/g;return t.replace(e,"")===n.replace(e,"")}function i(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,e=0,r=t.length;e<r;e++){var i=t[e];o(n,i.getAttribute("href"))&&(0,d.default)(i,"active")}}function u(t){for(var n=t.offsetLeft,e=t.offsetParent;null!==e;)n+=e.offsetLeft,e=e.offsetParent;return n}function f(t){for(var n=t.offsetTop,e=t.offsetParent;null!==e;)n+=e.offsetTop,e=e.offsetParent;return n}function c(t,n,e,r,o){var i=u(t),c=f(t)-n;if(c-e<=o){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,h.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(e||c)+"px",a.style.left=i+"px",a.style.zIndex=r||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");c(t,document.body.scrollTop,-63,2,0),c(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}function l(){x.default.versions.mobile&&window.screen.width<800&&(i(),s())}var p=e(71),d=r(p),v=e(72),y=(r(v),e(84)),h=r(y),b=e(69),x=r(b),m=e(75),g=r(m),w=e(70);l(),(0,w.addLoadEvent)(function(){g.default.init()}),t.exports={}},function(t,n){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t,n){var e={}.hasOwnProperty;t.exports=function(t,n){return e.call(t,n)}},function(t,n,e){var r=e(49),o=e(15);t.exports=function(t){return r(o(t))}},function(t,n,e){t.exports=!e(8)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,e){var r=e(6),o=e(12);t.exports=e(4)?function(t,n,e){return r.f(t,n,o(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n,e){var r=e(10),o=e(30),i=e(24),u=Object.defineProperty;n.f=e(4)?Object.defineProperty:function(t,n,e){if(r(t),n=i(n,!0),r(e),o)try{return u(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},function(t,n,e){var r=e(22)("wks"),o=e(13),i=e(1).Symbol,u="function"==typeof i,f=t.exports=function(t){return r[t]||(r[t]=u&&i[t]||(u?i:o)("Symbol."+t))};f.store=r},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){var r=e(35),o=e(16);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){var r=e(11);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var e=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+r).toString(36))}},function(t,n){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,e){var r=e(6).f,o=e(2),i=e(7)("toStringTag");t.exports=function(t,n,e){t&&!o(t=e?t:t.prototype,i)&&r(t,i,{configurable:!0,value:n})}},function(t,n,e){var r=e(22)("keys"),o=e(13);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,n,e){var r=e(1),o="__core-js_shared__",i=r[o]||(r[o]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)}},function(t,n,e){var r=e(11);t.exports=function(t,n){if(!r(t))return t;var e,o;if(n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;if("function"==typeof(e=t.valueOf)&&!r(o=e.call(t)))return o;if(!n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,n,e){var r=e(1),o=e(14),i=e(18),u=e(26),f=e(6).f;t.exports=function(t){var n=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==t.charAt(0)||t in n||f(n,t,{value:u.f(t)})}},function(t,n,e){n.f=e(7)},function(t,n,e){var r=e(1),o=e(14),i=e(46),u=e(5),f="prototype",c=function(t,n,e){var a,s,l,p=t&c.F,d=t&c.G,v=t&c.S,y=t&c.P,h=t&c.B,b=t&c.W,x=d?o:o[n]||(o[n]={}),m=x[f],g=d?r:v?r[n]:(r[n]||{})[f];d&&(e=n);for(a in e)s=!p&&g&&void 0!==g[a],s&&a in x||(l=s?g[a]:e[a],x[a]=d&&"function"!=typeof g[a]?e[a]:h&&s?i(l,r):b&&g[a]==l?function(t){var n=function(n,e,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,e)}return new t(n,e,r)}return t.apply(this,arguments)};return n[f]=t[f],n}(l):y&&"function"==typeof l?i(Function.call,l):l,y&&((x.virtual||(x.virtual={}))[a]=l,t&c.R&&m&&!m[a]&&u(m,a,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,n){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,n,e){var r=e(11),o=e(1).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,n,e){t.exports=!e(4)&&!e(8)(function(){return 7!=Object.defineProperty(e(29)("div"),"a",{get:function(){return 7}}).a})},function(t,n,e){"use strict";var r=e(18),o=e(27),i=e(36),u=e(5),f=e(2),c=e(17),a=e(51),s=e(20),l=e(58),p=e(7)("iterator"),d=!([].keys&&"next"in[].keys()),v="@@iterator",y="keys",h="values",b=function(){return this};t.exports=function(t,n,e,x,m,g,w){a(e,n,x);var O,S,_,j=function(t){if(!d&&t in A)return A[t];switch(t){case y:return function(){return new e(this,t)};case h:return function(){return new e(this,t)}}return function(){return new e(this,t)}},P=n+" Iterator",E=m==h,M=!1,A=t.prototype,T=A[p]||A[v]||m&&A[m],L=T||j(m),N=m?E?j("entries"):L:void 0,C="Array"==n?A.entries||T:T;if(C&&(_=l(C.call(new t)),_!==Object.prototype&&(s(_,P,!0),r||f(_,p)||u(_,p,b))),E&&T&&T.name!==h&&(M=!0,L=function(){return T.call(this)}),r&&!w||!d&&!M&&A[p]||u(A,p,L),c[n]=L,c[P]=b,m)if(O={values:E?L:j(h),keys:g?L:j(y),entries:N},w)for(S in O)S in A||i(A,S,O[S]);else o(o.P+o.F*(d||M),n,O);return O}},function(t,n,e){var r=e(10),o=e(55),i=e(16),u=e(21)("IE_PROTO"),f=function(){},c="prototype",a=function(){var t,n=e(29)("iframe"),r=i.length,o="<",u=">";for(n.style.display="none",e(48).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(o+"script"+u+"document.F=Object"+o+"/script"+u),t.close(),a=t.F;r--;)delete a[c][i[r]];return a()};t.exports=Object.create||function(t,n){var e;return null!==t?(f[c]=r(t),e=new f,f[c]=null,e[u]=t):e=a(),void 0===n?e:o(e,n)}},function(t,n,e){var r=e(35),o=e(16).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,e){var r=e(2),o=e(3),i=e(45)(!1),u=e(21)("IE_PROTO");t.exports=function(t,n){var e,f=o(t),c=0,a=[];for(e in f)e!=u&&r(f,e)&&a.push(e);for(;n.length>c;)r(f,e=n[c++])&&(~i(a,e)||a.push(e));return a}},function(t,n,e){t.exports=e(5)},function(t,n,e){var r=e(15);t.exports=function(t){return Object(r(t))}},function(t,n,e){t.exports={default:e(41),__esModule:!0}},function(t,n,e){t.exports={default:e(42),__esModule:!0}},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var o=e(39),i=r(o),u=e(38),f=r(u),c="function"==typeof f.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":typeof t};n.default="function"==typeof f.default&&"symbol"===c(i.default)?function(t){return"undefined"==typeof t?"undefined":c(t)}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":"undefined"==typeof t?"undefined":c(t)}},function(t,n,e){e(65),e(63),e(66),e(67),t.exports=e(14).Symbol},function(t,n,e){e(64),e(68),t.exports=e(26).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,e){var r=e(3),o=e(61),i=e(60);t.exports=function(t){return function(n,e,u){var f,c=r(n),a=o(c.length),s=i(u,a);if(t&&e!=e){for(;a>s;)if(f=c[s++],f!=f)return!0}else for(;a>s;s++)if((t||s in c)&&c[s]===e)return t||s||0;return!t&&-1}}},function(t,n,e){var r=e(43);t.exports=function(t,n,e){if(r(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)}}return function(){return t.apply(n,arguments)}}},function(t,n,e){var r=e(9),o=e(34),i=e(19);t.exports=function(t){var n=r(t),e=o.f;if(e)for(var u,f=e(t),c=i.f,a=0;f.length>a;)c.call(t,u=f[a++])&&n.push(u);return n}},function(t,n,e){t.exports=e(1).document&&document.documentElement},function(t,n,e){var r=e(28);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,n,e){var r=e(28);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){"use strict";var r=e(32),o=e(12),i=e(20),u={};e(5)(u,e(7)("iterator"),function(){return this}),t.exports=function(t,n,e){t.prototype=r(u,{next:o(1,e)}),i(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,e){var r=e(9),o=e(3);t.exports=function(t,n){for(var e,i=o(t),u=r(i),f=u.length,c=0;f>c;)if(i[e=u[c++]]===n)return e}},function(t,n,e){var r=e(13)("meta"),o=e(11),i=e(2),u=e(6).f,f=0,c=Object.isExtensible||function(){return!0},a=!e(8)(function(){return c(Object.preventExtensions({}))}),s=function(t){u(t,r,{value:{i:"O"+ ++f,w:{}}})},l=function(t,n){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,r)){if(!c(t))return"F";if(!n)return"E";s(t)}return t[r].i},p=function(t,n){if(!i(t,r)){if(!c(t))return!0;if(!n)return!1;s(t)}return t[r].w},d=function(t){return a&&v.NEED&&c(t)&&!i(t,r)&&s(t),t},v=t.exports={KEY:r,NEED:!1,fastKey:l,getWeak:p,onFreeze:d}},function(t,n,e){var r=e(6),o=e(10),i=e(9);t.exports=e(4)?Object.defineProperties:function(t,n){o(t);for(var e,u=i(n),f=u.length,c=0;f>c;)r.f(t,e=u[c++],n[e]);return t}},function(t,n,e){var r=e(19),o=e(12),i=e(3),u=e(24),f=e(2),c=e(30),a=Object.getOwnPropertyDescriptor;n.f=e(4)?a:function(t,n){if(t=i(t),n=u(n,!0),c)try{return a(t,n)}catch(t){}if(f(t,n))return o(!r.f.call(t,n),t[n])}},function(t,n,e){var r=e(3),o=e(33).f,i={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],f=function(t){try{return o(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==i.call(t)?f(t):o(r(t))}},function(t,n,e){var r=e(2),o=e(37),i=e(21)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,e){var r=e(23),o=e(15);t.exports=function(t){return function(n,e){var i,u,f=String(o(n)),c=r(e),a=f.length;return c<0||c>=a?t?"":void 0:(i=f.charCodeAt(c),i<55296||i>56319||c+1===a||(u=f.charCodeAt(c+1))<56320||u>57343?t?f.charAt(c):i:t?f.slice(c,c+2):(i-55296<<10)+(u-56320)+65536)}}},function(t,n,e){var r=e(23),o=Math.max,i=Math.min;t.exports=function(t,n){return t=r(t),t<0?o(t+n,0):i(t,n)}},function(t,n,e){var r=e(23),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){"use strict";var r=e(44),o=e(52),i=e(17),u=e(3);t.exports=e(31)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,o(1)):"keys"==n?o(0,e):"values"==n?o(0,t[e]):o(0,[e,t[e]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(t,n){},function(t,n,e){"use strict";var r=e(59)(!0);e(31)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=r(n,e),this._i+=t.length,{value:t,done:!1})})},function(t,n,e){"use strict";var r=e(1),o=e(2),i=e(4),u=e(27),f=e(36),c=e(54).KEY,a=e(8),s=e(22),l=e(20),p=e(13),d=e(7),v=e(26),y=e(25),h=e(53),b=e(47),x=e(50),m=e(10),g=e(3),w=e(24),O=e(12),S=e(32),_=e(57),j=e(56),P=e(6),E=e(9),M=j.f,A=P.f,T=_.f,L=r.Symbol,N=r.JSON,C=N&&N.stringify,k="prototype",F=d("_hidden"),q=d("toPrimitive"),I={}.propertyIsEnumerable,B=s("symbol-registry"),D=s("symbols"),W=s("op-symbols"),H=Object[k],K="function"==typeof L,R=r.QObject,J=!R||!R[k]||!R[k].findChild,U=i&&a(function(){return 7!=S(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(t,n,e){var r=M(H,n);r&&delete H[n],A(t,n,e),r&&t!==H&&A(H,n,r)}:A,G=function(t){var n=D[t]=S(L[k]);return n._k=t,n},$=K&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},z=function(t,n,e){return t===H&&z(W,n,e),m(t),n=w(n,!0),m(e),o(D,n)?(e.enumerable?(o(t,F)&&t[F][n]&&(t[F][n]=!1),e=S(e,{enumerable:O(0,!1)})):(o(t,F)||A(t,F,O(1,{})),t[F][n]=!0),U(t,n,e)):A(t,n,e)},Y=function(t,n){m(t);for(var e,r=b(n=g(n)),o=0,i=r.length;i>o;)z(t,e=r[o++],n[e]);return t},Q=function(t,n){return void 0===n?S(t):Y(S(t),n)},X=function(t){var n=I.call(this,t=w(t,!0));return!(this===H&&o(D,t)&&!o(W,t))&&(!(n||!o(this,t)||!o(D,t)||o(this,F)&&this[F][t])||n)},V=function(t,n){if(t=g(t),n=w(n,!0),t!==H||!o(D,n)||o(W,n)){var e=M(t,n);return!e||!o(D,n)||o(t,F)&&t[F][n]||(e.enumerable=!0),e}},Z=function(t){for(var n,e=T(g(t)),r=[],i=0;e.length>i;)o(D,n=e[i++])||n==F||n==c||r.push(n);return r},tt=function(t){for(var n,e=t===H,r=T(e?W:g(t)),i=[],u=0;r.length>u;)!o(D,n=r[u++])||e&&!o(H,n)||i.push(D[n]);return i};K||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=p(arguments.length>0?arguments[0]:void 0),n=function(e){this===H&&n.call(W,e),o(this,F)&&o(this[F],t)&&(this[F][t]=!1),U(this,t,O(1,e))};return i&&J&&U(H,t,{configurable:!0,set:n}),G(t)},f(L[k],"toString",function(){return this._k}),j.f=V,P.f=z,e(33).f=_.f=Z,e(19).f=X,e(34).f=tt,i&&!e(18)&&f(H,"propertyIsEnumerable",X,!0),v.f=function(t){return G(d(t))}),u(u.G+u.W+u.F*!K,{Symbol:L});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;nt.length>et;)d(nt[et++]);for(var nt=E(d.store),et=0;nt.length>et;)y(nt[et++]);u(u.S+u.F*!K,"Symbol",{for:function(t){return o(B,t+="")?B[t]:B[t]=L(t)},keyFor:function(t){if($(t))return h(B,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){J=!0},useSimple:function(){J=!1}}),u(u.S+u.F*!K,"Object",{create:Q,defineProperty:z,defineProperties:Y,getOwnPropertyDescriptor:V,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),N&&u(u.S+u.F*(!K||a(function(){var t=L();return"[null]"!=C([t])||"{}"!=C({a:t})||"{}"!=C(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!$(t)){for(var n,e,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);return n=r[1],"function"==typeof n&&(e=n),!e&&x(n)||(n=function(t,n){if(e&&(n=e.call(this,t,n)),!$(n))return n}),r[1]=n,C.apply(N,r)}}}),L[k][q]||e(5)(L[k],q,L[k].valueOf),l(L,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},function(t,n,e){e(25)("asyncIterator")},function(t,n,e){e(25)("observable")},function(t,n,e){e(62);for(var r=e(1),o=e(5),i=e(17),u=e(7)("toStringTag"),f=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var a=f[c],s=r[a],l=s&&s.prototype;l&&!l[u]&&o(l,u,a),i[a]=i.Array}},function(t,n){"use strict";var e={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")==-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")==-1,weixin:t.indexOf("MicroMessenger")==-1}}()};t.exports=e},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=e(40),i=r(o),u=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):o[t]||t}function n(t){return l[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,r=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},f=/\u00a0/g,c=/<br\s*\/?>/gi,a=/\r?\n/g,s=/\s/g,l={};for(var p in o)l[o[p]]=p;return o["&apos;"]="'",l["'"]="&#39;",{encode:function(t){return t?(""+t).replace(r,n).replace(a,"<br/>").replace(s,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(c,"\n").replace(e,t).replace(f," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e+=2)n.push(String.fromCharCode("0x"+t.slice(e,e+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,e=t.length;e>n;n++)t[n]=u.encodeObject(t[n]);else if("object"==("undefined"==typeof t?"undefined":(0,i.default)(t)))for(var r in t)t[r]=u.encodeObject(t[r]);else if("string"==typeof t)return u.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=u},function(t,n){function e(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=e},function(t,n){function e(t,n){if(t.classList)t.classList.remove(n);else{var e=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(e," ")}}t.exports=e},,,function(t,n){"use strict";function e(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){var n=document.querySelectorAll(".article-entry a:not(.article-more-a)");n.forEach(function(t){t.setAttribute("target","_blank")})}var e=document.querySelector("#js-aboutme");e&&0!==e.length&&(e.innerHTML=e.innerText)}t.exports={init:e}},,,,,,,,,function(t,n){function e(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var e=t.nextSibling;return e?t.parentNode.insertBefore(n,e):t.parentNode.appendChild(n)}t.exports=e}])</script><script src="/./main.2d7529.js"></script><script>!function(){var e=function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)};e("/slider.885efe.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">iOS</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">poem</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">随笔</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            2、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: true
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://www.jianshu.com/u/ad64332f3b23" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>简书</a>
            </li>
          
            <li class="search-li">
              <a href="https://github.com/ganyang-eyespage" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>GitHub</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">90年，一直认为自己是八零后.&lt;br&gt;&lt;br&gt;  知道自己在做什么，但目标模糊。自制力较差。更多时候偏于安逸，不思进取。厌恶大多数由于群居而自甘心平庸的动物，但由于各种原因未能免俗。又时也会有着奇怪的自信心.&lt;br&gt;&lt;br&gt;  相信长辈所说的：年轻是种罪过.&lt;br&gt;</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>